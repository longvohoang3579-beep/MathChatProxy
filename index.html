<!-- T·∫°o Video -->
<div class="tab-content" id="video">
  <div class="chat-box" id="videoBox"></div>
  <div class="pending-preview" id="videoPreview"></div>
  <div class="input-row">
    <label class="icon-btn" for="videoFileInput" title="T·∫£i ·∫£nh">üìÅ</label>
    <input type="file" id="videoFileInput" accept="image/*" hidden />
    <textarea id="videoPrompt" rows="1" placeholder="(T√πy ch·ªçn) m√¥ t·∫£ chi ti·∫øt th√™m cho video..."></textarea>
    <button id="btnVideo" class="send-btn" title="T·∫°o Video">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="white" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M5 12l14 7-7-7 7-7-14 7z" />
      </svg>
    </button>
  </div>
</div>

<script>
// =========================== VIDEO ==============================
let videoPendingFiles = [];
document.getElementById("videoFileInput").addEventListener("change", e => {
  videoPendingFiles = [...e.target.files];
  renderPreview("videoPreview", videoPendingFiles);
});

document.getElementById("btnVideo").addEventListener("click", async () => {
  const prompt = document.getElementById("videoPrompt").value.trim();
  if (!videoPendingFiles.length) {
    addBubble("videoBox", "‚ùå Vui l√≤ng ch·ªçn 1 ·∫£nh tr∆∞·ªõc.", "ai");
    return;
  }

  addBubbleWithFiles("videoBox", prompt || "(T·∫°o video t·ª´ ·∫£nh...)", videoPendingFiles, "user");
  document.getElementById("videoPrompt").value = "";
  document.getElementById("videoPreview").innerHTML = "";
  addBubble("videoBox", "üé¨ ƒêang t·∫°o video t·ª´ ·∫£nh...", "ai");

  const file = videoPendingFiles[0];
  const base64 = await toBase64(file);
  videoPendingFiles = [];

  try {
    const res = await fetch("/api/pollinations-video", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ imageBase64: base64, prompt })
    });
    const data = await res.json();
    if (data.videoUrl) {
      updateLastAIBubble("videoBox", `<img src="${data.videoUrl}" class="generated-image">`);
    } else {
      updateLastAIBubble("videoBox", "‚ùå Kh√¥ng th·ªÉ t·∫°o video.");
    }
  } catch (e) {
    console.error(e);
    updateLastAIBubble("videoBox", "‚ùå L·ªói k·∫øt n·ªëi server.");
  }
});
</script>
