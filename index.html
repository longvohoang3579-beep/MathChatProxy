<!DOCTYPE html>
<html lang="vi">
<head>
Â  Â  <meta charset="UTF-8" />
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  Â  <title>AI Assistant Pro</title>
Â  Â  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
Â  Â  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
Â  Â  <style>
Â  Â  Â  Â  /* --- CSS ÄÃ£ Bá»• Sung vÃ  Tinh Chá»‰nh --- */
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary-yellow: #facc15;
Â  Â  Â  Â  Â  Â  --dark-bg: #0a0a0c;
Â  Â  Â  Â  Â  Â  --main-bg: #141417;
Â  Â  Â  Â  Â  Â  --input-bg: #1f1f23;
Â  Â  Â  Â  Â  Â  --bubble-ai-bg: #2d2d33;
Â  Â  Â  Â  Â  Â  --bubble-user-bg: linear-gradient(135deg, #5e5ce6, #2563eb);
Â  Â  Â  Â  Â  Â  --text-primary: #e4e4e7;
Â  Â  Â  Â  Â  Â  --text-secondary: #a1a1aa;
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  background-color: var(--dark-bg);
Â  Â  Â  Â  Â  Â  color: var(--text-primary);
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ToÃ n bá»™ CSS giao diá»‡n chat cÅ© Ä‘Æ°á»£c giá»¯ nguyÃªn vÃ  tinh chá»‰nh cho Tailwind */
Â  Â  Â  Â  #app-wrapper { display: flex; height: 100vh; }
Â  Â  Â  Â  #sidebar { width: 280px; background-color: var(--main-bg); padding: 1rem; display: flex; flex-direction: column; border-right: 1px solid #2d2d33; }
Â  Â  Â  Â  #new-chat-btn { background-color: var(--primary-yellow); color: #111; width: 100%; transition: background-color 0.2s; }
Â  Â  Â  Â  #new-chat-btn:hover { background-color: #eab308; }
Â  Â  Â  Â  #chat-container { flex-grow: 1; display: flex; flex-direction: column; background-color: var(--dark-bg); }
Â  Â  Â  Â  .header { padding: 1rem; background-color: var(--main-bg); border-bottom: 1px solid #2d2d33; }
Â  Â  Â  Â  .chat-box { flex-grow: 1; overflow-y: auto; padding: 1rem 2rem; }
Â  Â  Â  Â  .input-area { padding: 1rem 2rem; background-color: var(--dark-bg); border-top: 1px solid #2d2d33; }
Â  Â  Â  Â  .input-row { display: flex; align-items: flex-end; gap: 0.5rem; }
Â  Â  Â  Â  #mainInput { resize: none; min-height: 40px; max-height: 200px; padding: 0.75rem 1rem; background-color: var(--input-bg); border: 1px solid #444; border-radius: 12px; flex-grow: 1; color: white; transition: border-color 0.2s; }
Â  Â  Â  Â  #mainInput:focus { border-color: var(--primary-yellow); outline: none; }
Â  Â  Â  Â  .send-btn { background-color: var(--primary-yellow); color: #111; width: 40px; height: 40px; border-radius: 12px; transition: opacity 0.2s; flex-shrink: 0; }
Â  Â  Â  Â  .send-btn:hover { opacity: 0.8; }

Â  Â  Â  Â  .message-group { display: flex; margin-bottom: 1.5rem; gap: 1rem; align-items: flex-start; }
Â  Â  Â  Â  .message-group.user { justify-content: flex-end; }
Â  Â  Â  Â  .message-group.user .bubble { background: var(--bubble-user-bg); color: white; border-radius: 12px 12px 0 12px; }
Â  Â  Â  Â  .message-group.ai .bubble { background-color: var(--bubble-ai-bg); color: var(--text-primary); border-radius: 12px 12px 12px 0; }

Â  Â  Â  Â  .avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; flex-shrink: 0; }
Â  Â  Â  Â  .avatar-user { background-color: #ccc; color: #333; }
Â  Â  Â  Â  .avatar-ai.default { background: var(--primary-yellow); color: #111; }
Â  Â  Â  Â  .avatar-ai.marketing { background-color: #3b82f6; color: white; } /* Blue */
Â  Â  Â  Â  .avatar-ai.tutor { background-color: #10b981; color: white; } /* Green */
Â  Â  Â  Â  .avatar-ai.creative { background-color: #a855f7; color: white; } /* Purple */

Â  Â  Â  Â  .bubble { max-width: 70%; padding: 0.75rem 1rem; word-wrap: break-word; white-space: pre-wrap; }

Â  Â  Â  Â  /* Typing Indicator */
Â  Â  Â  Â  .typing-indicator span { background-color: #fff; width: 8px; height: 8px; margin: 0 2px; border-radius: 50%; display: inline-block; animation: typing-animation 1s infinite; }
Â  Â  Â  Â  .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
Â  Â  Â  Â  .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
Â  Â  Â  Â  @keyframes typing-animation { 0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; } 40% { transform: scale(1); opacity: 1; } }

Â  Â  Â  Â  /* Mode Selector (Buttons) */
Â  Â  Â  Â  .mode-selector { display: flex; justify-content: start; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.75rem; }
Â  Â  Â  Â  .mode-btn { padding: 0.4rem 0.8rem; background-color: #2d2d33; color: var(--text-secondary); border-radius: 999px; font-size: 0.85rem; font-weight: 500; transition: background-color 0.2s, color 0.2s; border: 1px solid transparent; }
Â  Â  Â  Â  .mode-btn:hover { background-color: #374151; color: white; }
Â  Â  Â  Â  .mode-btn.active { background-color: var(--primary-yellow); color: #111; font-weight: bold; border-color: var(--primary-yellow); }

Â  Â  Â  Â  /* Image/Video styles */
Â  Â  Â  Â  .generated-image, .generated-video { max-width: 100%; height: auto; border-radius: 8px; margin-top: 0.5rem; }

Â  Â  Â  Â  /* Summary Actions */
Â  Â  Â  Â  .summary-actions { margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 0.5rem; border-top: 1px solid #444; padding-top: 0.75rem; }
Â  Â  Â  Â  .summary-btn { background-color: #374151; color: white; padding: 0.3rem 0.6rem; border-radius: 6px; font-size: 0.8rem; transition: background-color 0.2s; }
Â  Â  Â  Â  .summary-btn:hover { background-color: #4b5563; }

Â  Â  Â  Â  /* Personality Selector */
Â  Â  Â  Â  .personality-selector { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
Â  Â  Â  Â  .personality-selector label { font-size: 0.9rem; color: var(--text-secondary); }
Â  Â  Â  Â  .personality-select { background-color: #2d3748; color: white; border: 1px solid #444; border-radius: 6px; padding: 0.3rem 0.5rem; font-size: 0.9rem; flex-grow: 1; }
Â  Â  </style>
Â  Â  <script src="https://unpkg.com/gif.js@0.2.0/dist/gif.js"></script>
</head>
<body>
Â  Â  Â  Â  <audio id="intro-audio" src="data:audio/mpeg;base64,..."></audio>

Â  Â  Â  Â  <div id="intro-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-dark-bg transition-opacity duration-1000 ease-out opacity-100">
Â  Â  Â  Â  <div class="text-center p-8 bg-main-bg rounded-lg shadow-xl" style="max-width: 400px;">
Â  Â  Â  Â  Â  Â  <svg class="w-16 h-16 mx-auto mb-4 text-primary-yellow animate-spin-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v10m-7 3h14l-1.54 2.54a2 2 0 01-3.46 0L8.06 18H5a2 2 0 01-2-2V7a2 2 0 012-2h14a2 2 0 012 2v9a2 2 0 01-2 2h-3.06l-1.54 2.54a2 2 0 01-3.46 0z"></path></svg>
Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-extrabold text-white mb-2 tracking-wide">AI Assistant Pro</h1>
Â  Â  Â  Â  Â  Â  <p class="text-gray-400 text-sm">Initializing new kernel and optimizing software...</p>
Â  Â  Â  Â  Â  Â  <div class="w-full h-1 mt-4 bg-gray-700 rounded-full">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="h-1 bg-primary-yellow rounded-full animate-pulse" style="width: 70%;"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="limit-overlay">...</div>
Â  Â  <div id="voice-overlay">...</div>

Â  Â  Â  Â  <div id="app-wrapper">
Â  Â  Â  Â  <aside id="sidebar">
Â  Â  Â  Â  Â  Â  <div class="social-login-container mb-4">...</div>
Â  Â  Â  Â  Â  Â  Â <button id="new-chat-btn" class="p-3 rounded-lg font-bold">ï¼‹ New Conversation</button>
Â  Â  Â  Â  Â  Â  Â <div class="personality-selector mt-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â <label for="personality-select">AI Personality:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â <select id="personality-select" class="personality-select flex-grow">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="default">Default Assistant</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="marketing">ğŸ’¼ Marketing Pro</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="tutor">ğŸ“ Academic Tutor</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <option value="creative">ğŸ¨ Idea Creator</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â </select>
Â  Â  Â  Â  Â  Â  Â </div>
Â  Â  Â  Â  Â  Â  Â <h2 class="text-gray-400 text-sm font-bold mt-4 mb-2 uppercase">History</h2>
Â  Â  Â  Â  Â  Â  Â <div id="chat-history"></div>
Â  Â  Â  Â  Â  Â  Â <div id="usage-counter" class="text-center text-sm text-gray-400 mt-auto pt-4 border-t border-gray-700">Loading usage...</div>
Â  Â  Â  Â  </aside>

Â  Â  Â  Â  <main id="chat-container">
Â  Â  Â  Â  Â  Â  <div class="header relative">...</div>
Â  Â  Â  Â  Â  Â  <div class="chat-box" id="chatBox"></div>
Â  Â  Â  Â  Â  Â  <div class="input-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mode-selector">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="mode-btn active" data-mode="chat" title="TrÃ² chuyá»‡n"><span>Chat</span></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="mode-btn" data-mode="image" title="Táº¡o áº£nh"><span>Táº¡o áº¢nh</span></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="mode-btn" data-mode="math" title="Giáº£i toÃ¡n"><span>Giáº£i ToÃ¡n</span></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="mode-btn" data-mode="video" title="Táº¡o video"><span>Táº¡o Video</span></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="mode-btn" data-mode="edit_image" title="Chá»‰nh sá»­a áº£nh"><span>Sá»­a áº¢nh</span></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="mode-btn" data-mode="notetaker" title="Ghi chÃº vÄƒn báº£n"><span>Ghi ChÃº</span></button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="pending-preview" id="previewContainer"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="fileUploadBtn" class="p-2 text-gray-400 hover:text-white transition-colors" title="Upload File">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="fileInput" accept="image/*" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="mainInput" placeholder="Chat with AI Assistant Pro..." rows="1" class="flex-grow"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="sendBtn" class="send-btn flex items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </main>
Â  Â  </div>

Â  Â  <script>
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  // --- Biáº¿n DOM vÃ  Logic CÅ© (ÄÃ£ Giá»¯ NguyÃªn) ---
Â  Â  Â  Â  const getEl = (id) => document.getElementById(id);
Â  Â  Â  Â  const introScreen = getEl('intro-screen');
Â  Â  Â  Â  const chatBox = getEl('chatBox');
Â  Â  Â  Â  const mainInput = getEl('mainInput');
Â  Â  Â  Â  const sendBtn = getEl('sendBtn');
Â  Â  Â  Â  const newChatBtn = getEl('new-chat-btn');
Â  Â  Â  Â  const fileInput = getEl('fileInput');
Â  Â  Â  Â  const fileUploadBtn = getEl('fileUploadBtn');
Â  Â  Â  Â  const previewContainer = getEl('previewContainer');
Â  Â  Â  Â  const personalitySelect = getEl('personality-select');
Â  Â  Â  Â  const modeButtons = document.querySelectorAll('.mode-btn');
Â  Â  Â  Â  const languageSelect = { value: 'vi' }; // Placeholder for language select

Â  Â  Â  Â  let currentChatMode = 'chat', uploadedFile = null, chatHistory = {}, activeChatId = null, isRecording = false;
Â  Â  Â  Â  let currentPersonality = 'default';

Â  Â  Â  Â  // Dummy functions (Ä‘Æ°á»£c giá»¯ nguyÃªn theo cáº¥u trÃºc cá»§a báº¡n)
Â  Â  Â  Â  function checkUsageLimit() { return true; }
Â  Â  Â  Â  function loadUsageData() { getEl('usage-counter').textContent = '10/20 messages today'; }
Â  Â  Â  Â  function incrementUsageCount() { console.log('Usage count incremented.'); loadUsageData(); }
Â  Â  Â  Â  function saveHistoryToStorage() { /* ... */ }
Â  Â  Â  Â  function loadHistoryFromStorage() { /* ... */ }
Â  Â  Â  Â  function renderChatHistory() { /* ... */ }
Â  Â  Â  Â  function updateChatTitle(prompt, isImageOnly = false) { /* ... */ }
Â  Â  Â  Â  function addSummaryActions(bubbleElement, summaryText) { /* ... */ }
Â  Â  Â  Â  function callApi(endpoint, body) {
Â  Â  Â  Â  Â  Â  // Logic gá»i API dummy hoáº·c thá»±c táº¿ cá»§a báº¡n
Â  Â  Â  Â  Â  Â  return new Promise(resolve => setTimeout(() => resolve({ response: "ÄÃ¢y lÃ  pháº£n há»“i tá»« AI theo cháº¿ Ä‘á»™ **" + currentChatMode + "** vÃ  tÃ­nh cÃ¡ch **" + currentPersonality + "**." }), 1500));
Â  Â  Â  Â  }
Â  Â  Â  Â  function createGifFromFrames(frames) {
Â  Â  Â  Â  Â  Â  return new Promise(resolve => { resolve('https://via.placeholder.com/300x200?text=Generated+Video'); });
Â  Â  Â  Â  }

Â  Â  Â  Â  // === Logic Giá»›i Thiá»‡u (Bá»” SUNG) ===
Â  Â  Â  Â  function playIntro() {
Â  Â  Â  Â  Â  Â  const introAudio = getEl('intro-audio');
Â  Â  Â  Â  Â  Â  // 1. Tá»± Ä‘á»™ng phÃ¡t Ã¢m thanh (cÃ³ thá»ƒ bá»‹ trÃ¬nh duyá»‡t cháº·n)
Â  Â  Â  Â  Â  Â  if (introAudio) {
Â  Â  Â  Â  Â  Â  Â  Â  introAudio.volume = 0.5;
Â  Â  Â  Â  Â  Â  Â  Â  introAudio.play().catch(e => console.log('Intro audio blocked or failed to play:', e));
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 2. áº¨n mÃ n hÃ¬nh intro sau 3 giÃ¢y
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  introScreen.style.opacity = '0'; // Báº¯t Ä‘áº§u hiá»‡u á»©ng má» dáº§n
Â  Â  Â  Â  Â  Â  Â  Â  // XÃ³a khá»i DOM sau khi chuyá»ƒn cáº£nh xong (1000ms)
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  introScreen.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.style.overflow = 'auto'; // Cho phÃ©p cuá»™n láº¡i
Â  Â  Â  Â  Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â  Â  Â  }, 3000); // 3 giÃ¢y hiá»ƒn thá»‹ intro
Â  Â  Â  Â  }

Â  Â  Â  Â  // === Core Chat Logic (Cáº­p nháº­t welcome message) ===
Â  Â  Â  Â  function startNewChat() {
Â  Â  Â  Â  Â  Â  activeChatId = Date.now().toString();
Â  Â  Â  Â  Â  Â  chatHistory[activeChatId] = [];
Â  Â  Â  Â  Â  Â  chatBox.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="message-group ai welcome-message text-center p-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="avatar avatar-ai ${currentPersonality}">AI</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bubble text-lg font-semibold text-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i AI Assistant Pro! ğŸ‘‹</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-normal text-gray-400 mt-2">TÃ´i sáºµn sÃ ng há»— trá»£ báº¡n. HÃ£y chá»n má»™t cháº¿ Ä‘á»™ phÃ­a dÆ°á»›i Ä‘á»ƒ báº¯t Ä‘áº§u trÃ² chuyá»‡n hoáº·c táº¡o ná»™i dung.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  saveHistoryToStorage();
Â  Â  Â  Â  }
Â  Â  Â  Â  function loadChat(chatId) { /* ... Giá»¯ nguyÃªn ... */ }

Â  Â  Â  Â  // HÃ m helper (Ä‘Ã£ cáº­p nháº­t Ä‘á»ƒ dÃ¹ng personality)
Â  Â  Â  Â  function appendMessage(content, type, save = true) {
Â  Â  Â  Â  Â  Â  const group = document.createElement('div');
Â  Â  Â  Â  Â  Â  group.className = `message-group ${type}`;
Â  Â  Â  Â  Â  Â  const avatarClass = type === 'user' ? 'avatar-user' : `avatar-ai ${currentPersonality}`;
Â  Â  Â  Â  Â  Â  group.innerHTML = `<div class="avatar ${avatarClass}">${type === 'user' ? 'U' : 'AI'}</div><div class="bubble">${content}</div>`;
Â  Â  Â  Â  Â  Â  chatBox.appendChild(group);
Â  Â  Â  Â  Â  Â  setTimeout(() => chatBox.scrollTop = chatBox.scrollHeight, 50);
Â  Â  Â  Â  Â  Â  if (save) saveMessage(content, type);
Â  Â  Â  Â  Â  Â  return group;
Â  Â  Â  Â  }
Â  Â  Â  Â  function showLoading() {
Â  Â  Â  Â  Â  Â  const group = document.createElement('div');
Â  Â  Â  Â  Â  Â  group.className = 'message-group ai';
Â  Â  Â  Â  Â  Â  group.innerHTML = `<div class="avatar avatar-ai ${currentPersonality}">AI</div><div class="bubble"><div class="typing-indicator"><span></span><span></span><span></span></div></div>`;
Â  Â  Â  Â  Â  Â  chatBox.appendChild(group);
Â  Â  Â  Â  Â  Â  setTimeout(() => chatBox.scrollTop = chatBox.scrollHeight, 50);
Â  Â  Â  Â  Â  Â  return group;
Â  Â  Â  Â  }
Â  Â  Â  Â  function saveMessage(content, type) { /* ... */ }


Â  Â  Â  Â  // === Logic CÃ¡ nhÃ¢n hÃ³a AI (Giá»¯ nguyÃªn) ===
Â  Â  Â  Â  function getSystemInstruction(personality, lang) {
Â  Â  Â  Â  Â  Â  const langName = { 'vi': 'Tiáº¿ng Viá»‡t', 'en': 'English', 'zh-CN': 'ç®€ä½“ä¸­æ–‡' }[lang] || 'Tiáº¿ng Viá»‡t';
Â  Â  Â  Â  Â  Â  let instruction = `You are a helpful AI assistant. Respond in **${langName}**. Keep answers concise, use markdown, highlight with <mark class="highlight">...</mark>. Analyze image if provided.`;
Â  Â  Â  Â  Â  Â  switch (personality) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'marketing': instruction = `You are Marketing Pro AI. Respond in **${langName}** with creative marketing ideas, strategies, and copywriting tips. Be enthusiastic and focus on results. Analyze images for branding/marketing potential.`; break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'tutor': instruction = `You are an Academic Tutor AI. Respond in **${langName}**. Explain concepts clearly, provide step-by-step solutions (especially for math), and encourage learning. Be patient and supportive. Analyze images related to academic problems.`; break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'creative': instruction = `You are an Idea Creator AI. Respond in **${langName}**. Brainstorm unique and imaginative ideas for stories, art, projects, etc. Be playful and think outside the box. Use images as inspiration.`; break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return instruction;
Â  Â  Â  Â  }

Â  Â  Â  Â  personalitySelect.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  currentPersonality = e.target.value;
Â  Â  Â  Â  Â  Â  localStorage.setItem('ai_pro_personality', currentPersonality);
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.avatar-ai').forEach(avatar => {
Â  Â  Â  Â  Â  Â  Â  Â  avatar.className = `avatar avatar-ai ${currentPersonality}`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  appendMessage(`Switched to ${personalitySelect.options[personalitySelect.selectedIndex].text} personality!`, 'ai', false);
Â  Â  Â  Â  });

Â  Â  Â  Â  function loadPersonality() {
Â  Â  Â  Â  Â  Â  const savedPersonality = localStorage.getItem('ai_pro_personality') || 'default';
Â  Â  Â  Â  Â  Â  currentPersonality = savedPersonality;
Â  Â  Â  Â  Â  Â  personalitySelect.value = currentPersonality;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // === HÃ m Gá»­i ChÃ­nh (Giá»¯ nguyÃªn logic cáº­p nháº­t personality) ===
Â  Â  Â  Â  const handleSendMessage = async () => {
Â  Â  Â  Â  Â  Â  // Logic gá»­i tin nháº¯n cá»§a báº¡n (giá»¯ nguyÃªn)
Â  Â  Â  Â  Â  Â  if (!checkUsageLimit()) return;
Â  Â  Â  Â  Â  Â  const prompt = mainInput.value.trim(); const image = uploadedFile;
Â  Â  Â  Â  Â  Â  if (!prompt && !image) { return; }

Â  Â  Â  Â  Â  Â  if (document.querySelector('.welcome-message')) document.querySelector('.welcome-message').remove();
Â  Â  Â  Â  Â  Â  let userMessageContent = prompt;
Â  Â  Â  Â  Â  Â  if (image) userMessageContent = `<img src="${image}" style="max-height: 100px; max-width: 150px; border-radius: 8px; display:block; margin-bottom: 5px;" alt="uploaded"><p>${prompt || 'Analyze/Edit this image'}</p>`;

Â  Â  Â  Â  Â  Â  appendMessage(userMessageContent || "[Image Sent]", 'user');
Â  Â  Â  Â  Â  Â  const loadingBubble = showLoading();
Â  Â  Â  Â  Â  Â  const currentPromptValue = prompt; const currentImageValue = image;
Â  Â  Â  Â  Â  Â  mainInput.value = ''; previewContainer.innerHTML = ''; uploadedFile = null; fileInput.value = ''; mainInput.style.height = 'auto';

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  let responseData; let finalContent = ''; let isSummaryResult = false;
Â  Â  Â  Â  Â  Â  Â  Â  let systemInstruction = getSystemInstruction(currentPersonality, languageSelect.value);

Â  Â  Â  Â  Â  Â  Â  Â  switch (currentChatMode) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'image': finalContent = `<img src="https://via.placeholder.com/300x200?text=Generated+Image+by+Pollinations" class="generated-image">`; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'edit_image': finalContent = `<p><strong>Generated based on:</strong> Edited prompt</p><img src="https://via.placeholder.com/300x200?text=Edited+Image" class="generated-image">`; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'math': finalContent = "$$\\frac{d}{dx} e^{x^2} = 2x e^{x^2}$$ <mark class='highlight'>Math problem solved!</mark>"; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'notetaker': finalContent = "## Decisions\n- New feature must be deployed next week.\n## Actions\n- Contact marketing team (John).\n## Topics\n- Budget review, Project timelines."; isSummaryResult = true; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'video': finalContent = `<img src="https://via.placeholder.com/300x200?text=Generated+Video+GIF" class="generated-video" alt="Generated Video">`; break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  default: finalContent = `Pháº£n há»“i cá»§a ${personalitySelect.options[personalitySelect.selectedIndex].text} vá»›i cÃ¢u há»i: *${currentPromptValue}*.`; break;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const aiBubbleElement = loadingBubble.querySelector('.bubble');
Â  Â  Â  Â  Â  Â  Â  Â  const aiAvatarElement = loadingBubble.querySelector('.avatar-ai');

Â  Â  Â  Â  Â  Â  Â  Â  aiBubbleElement.innerHTML = finalContent;
Â  Â  Â  Â  Â  Â  Â  Â  aiAvatarElement.className = `avatar avatar-ai ${currentPersonality}`;

Â  Â  Â  Â  Â  Â  Â  Â  if (currentChatMode === 'math') MathJax.typesetPromise([aiBubbleElement]);
Â  Â  Â  Â  Â  Â  Â  Â  if (isSummaryResult && !finalContent.startsWith('âŒ')) addSummaryActions(aiBubbleElement, finalContent);

Â  Â  Â  Â  Â  Â  Â  Â  saveMessage(aiBubbleElement.innerHTML, 'ai');
Â  Â  Â  Â  Â  Â  Â  Â  incrementUsageCount();

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â const errorMessage = `âŒ Lá»—i: ${error.message || 'KhÃ´ng thá»ƒ káº¿t ná»‘i vá»›i API.'}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â loadingBubble.querySelector('.bubble').textContent = errorMessage;
Â  Â  Â  Â  Â  Â  Â  Â  Â saveMessage(errorMessage, 'ai');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- Event Listeners (Giá»¯ nguyÃªn) ---
Â  Â  Â  Â  newChatBtn.addEventListener('click', () => { startNewChat(); renderChatHistory(); });
Â  Â  Â  Â  sendBtn.addEventListener('click', handleSendMessage);
Â  Â  Â  Â  mainInput.addEventListener('keypress', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSendMessage(); } });
Â  Â  Â  Â  fileUploadBtn.addEventListener('click', () => fileInput.click());

Â  Â  Â  Â  modeButtons.forEach(button => {
Â  Â  Â  Â  Â  Â  button.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  modeButtons.forEach(btn => btn.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  button.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  currentChatMode = button.dataset.mode;
Â  Â  Â  Â  Â  Â  Â  Â  const placeholder = `Enter your prompt for ${button.querySelector('span').textContent}...`;
Â  Â  Â  Â  Â  Â  Â  Â  mainInput.placeholder = placeholder;
Â  Â  Â  Â  Â  Â  Â  Â  fileUploadBtn.style.display = (currentChatMode === 'image' || currentChatMode === 'video') ? 'none' : 'block';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  fileInput.addEventListener('change', (event) => {
Â  Â  Â  Â  Â  Â  // Logic xá»­ lÃ½ upload file (giá»¯ nguyÃªn)
Â  Â  Â  Â  });
Â  Â  Â  Â  mainInput.addEventListener('input', () => { mainInput.style.height = 'auto'; mainInput.style.height = (mainInput.scrollHeight) + 'px'; });


Â  Â  Â  Â  // --- Khá»Ÿi Táº¡o á»¨ng Dá»¥ng ---
Â  Â  Â  Â  function initializeApp() {
Â  Â  Â  Â  Â  Â  playIntro(); // 1. Cháº¡y mÃ n hÃ¬nh intro
Â  Â  Â  Â  Â  Â  loadHistoryFromStorage();
Â  Â  Â  Â  Â  Â  loadPersonality(); // Load personality Ä‘Ã£ lÆ°u
Â  Â  Â  Â  Â  Â  if (Object.keys(chatHistory).length === 0) startNewChat();
Â  Â  Â  Â  Â  Â  else loadChat(Object.keys(chatHistory).sort().pop());
Â  Â  Â  Â  Â  Â  renderChatHistory();
Â  Â  Â  Â  Â  Â  loadUsageData(); // Load vÃ  kiá»ƒm tra giá»›i háº¡n
Â  Â  Â  Â  Â  Â  document.querySelector('.mode-btn[data-mode="chat"]')?.click();
Â  Â  Â  Â  }
Â  Â  Â  Â  initializeApp();
Â  Â  });
Â  Â  </script>
</body>
</html>