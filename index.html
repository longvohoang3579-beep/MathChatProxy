<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Assistant Pro</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<style>
body {
  margin: 0;
  padding: 0;
  background-color: #0f0f13;
  color: #fff;
  font-family: 'Segoe UI', sans-serif;
  overflow: hidden;
}

/* ===== INTRO - Canvas r·ªìng ph∆∞·ª£ng √°nh kim ===== */
#intro-screen {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100vh;
  background: radial-gradient(circle at 50% 50%, #000000 0%, #1a1300 100%);
  display: flex; align-items: center; justify-content: center;
  flex-direction: column;
  z-index: 1000;
  overflow: hidden;
}

#intro-canvas {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 1;
}

#intro-text {
  position: relative;
  color: #facc15;
  font-size: 2.6rem;
  font-weight: bold;
  text-shadow: 0 0 25px #facc15, 0 0 50px #ffcc33;
  z-index: 2;
  animation: floatText 3s ease-in-out infinite alternate;
}

@keyframes floatText {
  from { transform: translateY(0); opacity: 1; }
  to { transform: translateY(-8px); opacity: 0.9; }
}

#intro-subtext {
  color: #fff8dc;
  margin-top: 0.5rem;
  font-size: 1.1rem;
  opacity: 0.85;
  text-shadow: 0 0 15px rgba(255,255,200,0.4);
  z-index: 2;
  animation: fadeIn 3s ease-in-out 1.5s forwards;
  opacity: 0;
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Burst v√†ng khi k·∫øt th√∫c intro */
#burst {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: radial-gradient(circle at center, rgba(255,215,0,1) 0%, rgba(255,215,0,0.5) 40%, transparent 80%);
  opacity: 0;
  z-index: 5;
  pointer-events: none;
  transition: opacity 1.2s ease-out;
}

/* ===== MAIN APP (4 KHUNG CHAT G·ªêC) ===== */
.container {max-width:900px;margin:2rem auto;background:#1a1c29;border-radius:1.5rem;padding:1.5rem;box-shadow:0 15px 30px rgba(0,0,0,0.7);display:none;}
.tabs {display:flex;border-bottom:2px solid #333;margin-bottom:1rem;}
.tab-btn {flex:1;text-align:center;padding:1rem;cursor:pointer;color:#aaa;font-weight:bold;transition:all 0.2s;}
.tab-btn.active {color:#fff;border-bottom:3px solid #facc15;}
.tab-content {display:none;}
.tab-content.active {display:block;}
.chat-box {background:#111827;border-radius:12px;padding:1rem;height:400px;overflow-y:auto;display:flex;flex-direction:column;scroll-behavior:smooth;}
.bubble {max-width:80%;padding:10px 14px;border-radius:12px;margin-bottom:10px;line-height:1.5;word-wrap:break-word;white-space:pre-wrap;}
.user-bubble {background:#2563eb;align-self:flex-end;color:white;border-bottom-right-radius:2px;}
.ai-bubble {background:#374151;align-self:flex-start;color:#e5e7eb;border-bottom-left-radius:2px;}
mark.highlight {background-color:#fde047;color:black;font-weight:bold;padding:0 3px;border-radius:3px;}
textarea,input{width:100%;padding:0.75rem;border-radius:0.75rem;background:#1e1e2a;border:1px solid #333;color:white;resize:none;outline:none;}
button{padding:0.75rem 1rem;border-radius:0.75rem;font-weight:bold;cursor:pointer;transition:all 0.2s;border:none;}
#btnCreateImage{background:#10b981;color:#111827;}#btnCreateImage:hover{background:#059669;}
.send-btn{background:#6366f1;color:white;} .send-btn:hover{background:#4f46e5;}
img.generated-image, .generated-video {border-radius:12px;max-width:100%;margin-top:1rem;display:block;max-height:400px;margin-left:auto;margin-right:auto;}
</style>
</head>

<body>
<!-- INTRO -->
<div id="intro-screen">
  <canvas id="intro-canvas"></canvas>
  <div id="burst"></div>
  <div id="intro-text">üêâ <mark class="highlight">AI Assistant Pro</mark> üïäÔ∏è</div>
  <div id="intro-subtext">Unleash the golden power of intelligence.</div>
</div>

<!-- 4 KHUNG CHAT G·ªêC -->
<div class="container" id="mainApp">
  <div class="tabs">
    <div class="tab-btn active" data-tab="chat">üí¨ Chat</div>
    <div class="tab-btn" data-tab="math">üßÆ Gi·∫£i To√°n</div>
    <div class="tab-btn" data-tab="image">üé® T·∫°o ·∫¢nh</div>
    <div class="tab-btn" data-tab="video">üé¨ T·∫°o Video</div>
  </div>

  <div id="chat" class="tab-content active">
    <div class="chat-box" id="chatBox"></div>
    <div class="input-row">
      <textarea id="chatInput" rows="2" placeholder="Nh·∫≠p tin nh·∫Øn..."></textarea>
      <button class="send-btn" onclick="sendMessage('chat')">‚û§</button>
    </div>
  </div>

  <div id="math" class="tab-content">
    <div class="chat-box" id="mathBox"></div>
    <div class="input-row">
      <textarea id="mathInput" rows="2" placeholder="Nh·∫≠p b√†i to√°n..."></textarea>
      <button class="send-btn" onclick="sendMessage('math')">‚û§</button>
    </div>
  </div>

  <div id="image" class="tab-content">
    <div class="chat-box" id="imageBox"></div>
    <div class="input-row">
      <textarea id="imageInput" rows="2" placeholder="M√¥ t·∫£ h√¨nh ·∫£nh..."></textarea>
      <button id="btnCreateImage" onclick="sendMessage('image')">T·∫°o ·∫¢nh</button>
    </div>
  </div>

  <div id="video" class="tab-content">
    <div class="chat-box" id="videoBox"></div>
    <div class="input-row">
      <textarea id="videoInput" rows="2" placeholder="M√¥ t·∫£ video..."></textarea>
      <button class="send-btn" onclick="sendMessage('video')">‚û§</button>
    </div>
  </div>
</div>

<script>
// ========== INTRO CANVAS ========== //
const canvas = document.getElementById("intro-canvas");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let particles = [];
function createParticle(x, y, color) {
  return {
    x, y,
    vx: (Math.random() - 0.5) * 3,
    vy: (Math.random() - 0.5) * 3,
    size: Math.random() * 3 + 1,
    color,
  };
}

function drawDragonPhoenix() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  particles.forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    ctx.fillStyle = p.color;
    ctx.fill();
    p.x += p.vx;
    p.y += p.vy;
    if (p.x < 0 || p.x > canvas.width || p.y < 0 || p.y > canvas.height) {
      p.x = Math.random() * canvas.width;
      p.y = Math.random() * canvas.height;
    }
  });
  requestAnimationFrame(drawDragonPhoenix);
}

function initParticles() {
  const colors = ["#ffd700", "#ffb347", "#ff6347", "#ffa500", "#fff1b2"];
  for (let i = 0; i < 500; i++) {
    particles.push(createParticle(Math.random() * canvas.width, Math.random() * canvas.height, colors[Math.floor(Math.random() * colors.length)]));
  }
}
initParticles();
drawDragonPhoenix();

function burstEffect() {
  const burst = document.getElementById("burst");
  burst.style.opacity = "1";
  setTimeout(() => {
    burst.style.opacity = "0";
  }, 800);
}

// ========== INTRO EXIT ========== //
function playIntro() {
  const intro = document.getElementById("intro-screen");
  const mainApp = document.getElementById("mainApp");
  setTimeout(() => {
    burstEffect();
    intro.style.transition = "opacity 2s ease";
    intro.style.opacity = "0";
    setTimeout(() => {
      intro.style.display = "none";
      mainApp.style.display = "block";
      document.body.style.overflow = "auto";
    }, 2000);
  }, 6000);
}
playIntro();

// ========== TAB SWITCHING ========== //
document.querySelectorAll(".tab-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(c => c.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById(btn.dataset.tab).classList.add("active");
  });
});

// ========== G·ª¨I L√äN SERVER (API HO·∫†T ƒê·ªòNG) ========== //
function sendMessage(type) {
  const input = document.getElementById(type + "Input");
  const box = document.getElementById(type + "Box");
  const text = input.value.trim();
  if (!text) return;

  const userBubble = document.createElement("div");
  userBubble.className = "bubble user-bubble";
  userBubble.textContent = text;
  box.appendChild(userBubble);
  input.value = "";

  const aiBubble = document.createElement("div");
  aiBubble.className = "bubble ai-bubble";
  aiBubble.textContent = "‚è≥ ƒêang x·ª≠ l√Ω...";
  box.appendChild(aiBubble);
  box.scrollTop = box.scrollHeight;

  fetch(`/api/${type}`, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ message: text })
  })
  .then(res => res.json())
  .then(data => {
    aiBubble.innerHTML = data.reply || "Kh√¥ng c√≥ ph·∫£n h·ªìi.";
    MathJax.typesetPromise();
    box.scrollTop = box.scrollHeight;
  })
  .catch(() => aiBubble.textContent = "‚ö†Ô∏è L·ªói khi g·ª≠i y√™u c·∫ßu.");
}
</script>
</body>
</html>
