<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Assistant Pro</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<style>
body {
Â Â background-color:#0f0f13; color:#fff; font-family:'Segoe UI',sans-serif;
Â Â margin:0; padding:0; overflow:hidden;
}
Â 
/* ---------- Intro ---------- */
#intro-screen {
Â Â position: fixed;
Â Â top:0; left:0; width:100%; height:100vh;
Â Â background: radial-gradient(circle at center, #1a1c29 0%, #0a0a0a 80%);
Â Â overflow:hidden;
Â Â display:flex; align-items:center; justify-content:center;
Â Â flex-direction:column; z-index:1000;
Â Â transition:opacity 1.8s ease;
}
#intro-bg {
Â Â position:absolute; top:0; left:0; width:100%; height:100%;
Â Â background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.07) 0%, transparent 60%),
Â Â Â Â Â Â Â Â Â Â Â Â Â Â radial-gradient(circle at 70% 70%, rgba(255,255,255,0.05) 0%, transparent 60%),
Â Â Â Â Â Â Â Â Â Â Â Â Â Â radial-gradient(circle at 50% 100%, rgba(122, 255, 255, 0.08) 0%, transparent 70%);
Â Â animation: glowMove 10s ease-in-out infinite alternate;
Â Â filter: blur(50px);
}
@keyframes glowMove {
Â Â 0% { transform: scale(1) translate(0, 0); }
Â Â 100% { transform: scale(1.2) translate(20px, -20px); }
}
#intro-text {
Â Â position:relative;
Â Â color:#facc15;
Â Â font-size:2.3rem; font-weight:bold;
Â Â text-shadow:0 0 20px rgba(255, 255, 150, 0.8), 0 0 40px rgba(255,255,255,0.4);
Â Â animation: floatText 3s ease-in-out infinite alternate;
}
@keyframes floatText {
Â Â 0% { transform: translateY(0); opacity:1; }
Â Â 100% { transform: translateY(-10px); opacity:0.95; }
}
#intro-subtext {
Â Â color:#e0e7ff;
Â Â margin-top:1rem;
Â Â font-size:1.1rem;
Â Â opacity:0.85;
Â Â text-shadow:0 0 10px rgba(255,255,255,0.3);
Â Â animation: fadeIn 3s ease-in-out 1.5s forwards;
Â Â opacity:0;
}
@keyframes fadeIn {
Â Â from { opacity:0; }
Â Â to { opacity:1; }
}
Â 
/* ---------- Main Container ---------- */
.container {max-width:900px;margin:2rem auto;background:#1a1c29;border-radius:1.5rem;padding:1.5rem;box-shadow:0 15px 30px rgba(0,0,0,0.7);display:none;}
.tabs {display:flex;border-bottom:2px solid #333;margin-bottom:1rem;}
.tab-btn {flex:1;text-align:center;padding:1rem;cursor:pointer;color:#aaa;font-weight:bold;transition:all 0.2s;}
.tab-btn.active {color:#fff;border-bottom:3px solid #facc15;}
.tab-content {display:none;}
.tab-content.active {display:block;}
.chat-box {background:#111827;border-radius:12px;padding:1rem;height:400px;overflow-y:auto;display:flex;flex-direction:column;}
.bubble {max-width:80%;padding:10px 14px;border-radius:12px;margin-bottom:10px;line-height:1.5;word-wrap:break-word;white-space:pre-wrap;}
.user-bubble {background:#2563eb;align-self:flex-end;color:white;border-bottom-right-radius:2px;}
.ai-bubble {background:#374151;align-self:flex-start;color:#e5e7eb;border-bottom-left-radius:2px;}
mark.highlight {background-color:#fde047;color:black;font-weight:bold;padding:0 3px;border-radius:3px;}
textarea,input{width:100%;padding:0.75rem;border-radius:0.75rem;background:#1e1e2a;border:1px solid #333;color:white;resize:none;outline:none;}
button{padding:0.75rem 1rem;border-radius:0.75rem;font-weight:bold;cursor:pointer;transition:all 0.2s;}
#btnCreateImage{background:#10b981;color:#111827;}#btnCreateImage:hover{background:#059669;}
#btnChat{background:#6366f1;color:white;}#btnChat:hover{background:#4f46e5;}
#btnMath{background:#f59e0b;color:#111827;}#btnMath:hover{background:#d97706;}
img.generated-image{border-radius:12px;max-width:100%;margin-top:1rem;}
#settings-btn{position:absolute;top:1rem;right:1rem;font-size:1.5rem;cursor:pointer;color:#facc15;}
#settings-modal{position:absolute;top:3rem;right:1rem;width:200px;background:#1a1c29;border:1px solid #facc15;border-radius:0.75rem;padding:1rem;display:none;}
.pending-preview{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px;}
.pending-preview img{width:60px;height:60px;object-fit:cover;border-radius:8px;border:2px solid #475569;}
.input-row{display:flex;align-items:center;gap:6px;margin-top:8px;}
.icon-btn{background:#27293a;padding:8px;border-radius:8px;cursor:pointer;transition:0.2s;}
.icon-btn:hover{background:#3f4259;}
.icon-btn svg{width:22px;height:22px;color:#facc15;}
.send-btn{background:#6366f1;padding:10px;border-radius:50%;display:flex;align-items:center;justify-content:center;}
.send-btn:hover{background:#4f46e5;}
.send-btn svg{width:22px;height:22px;transform:rotate(0deg);}
.generated-video{border-radius:12px;max-width:100%;margin-top:1rem;}
</style>
<script src="https://unpkg.com/gif.js@0.2.0/dist/gif.js"></script>
<script src="https://unpkg.com/gif.js@0.2.0/dist/gif.worker.js"></script>
</head>
Â 
<body>
<div id="intro-screen">
Â Â <div id="intro-bg"></div>
Â Â <div id="intro-text">ğŸŒŒ Welcome to <mark class="highlight">AI Assistant Pro</mark> ğŸŒŒ</div>
Â Â <div id="intro-subtext">Unleash the magic of creativity and intelligence.</div>
</div>
Â 
<div class="container relative" id="mainApp">
Â Â <div id="settings-btn">âš™ï¸</div>
Â Â <div id="settings-modal">
Â Â Â Â <label class="block mb-2">NgÃ´n ngá»¯ chat:</label>
Â Â Â Â <select id="language-select" class="w-full p-2 rounded bg-gray-800 text-white">
Â Â Â Â Â Â <option value="vi">Tiáº¿ng Viá»‡t</option>
Â Â Â Â Â Â <option value="en">English</option>
Â Â Â Â Â Â <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
Â Â Â Â </select>
Â Â </div>
Â 
Â Â <div class="tabs">
Â Â Â Â <div class="tab-btn active" data-tab="image">ğŸ–¼ï¸ Táº¡o áº¢nh</div>
Â Â Â Â <div class="tab-btn" data-tab="chat">ğŸ’¬ Chat</div>
Â Â Â Â <div class="tab-btn" data-tab="math">ğŸ§® Giáº£i ToÃ¡n</div>
Â Â Â Â <div class="tab-btn" data-tab="video">ğŸï¸ Táº¡o Video</div>
Â Â </div>
Â 
Â Â <div class="tab-content active" id="image">
Â Â Â Â <div class="chat-box" id="imageBox"></div>
Â Â Â Â <textarea id="imagePrompt" rows="2" placeholder="Nháº­p mÃ´ táº£ áº£nh..."></textarea>
Â Â Â Â <button id="btnCreateImage" class="mt-2 w-full">Táº¡o áº¢nh</button>
Â Â </div>
Â 
Â Â <div class="tab-content" id="chat">
Â Â Â Â <div class="chat-box" id="chatBox"></div>
Â Â Â Â <div class="pending-preview" id="chatPreview"></div>
Â Â Â Â <div class="input-row">
Â Â Â Â Â Â <label class="icon-btn" for="chatFileInput" title="Táº£i áº£nh hoáº·c file">ğŸ“</label>
Â Â Â Â Â Â <input type="file" id="chatFileInput" accept="image/*,.pdf,.txt,.docx" hidden />
Â Â Â Â Â Â <label class="icon-btn" id="chatCameraBtn" title="Chá»¥p áº£nh">ğŸ“·</label>
Â Â Â Â Â Â <textarea id="chatInput" rows="1" placeholder="Nháº­p tin nháº¯n..."></textarea>
Â Â Â Â Â Â <button id="btnChat" class="send-btn" title="Gá»­i">
Â Â Â Â Â Â Â Â <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="white" viewBox="0 0 24 24">
Â Â Â Â Â Â Â Â Â Â <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12l14 7-7-7 7-7-14 7z"/>
Â Â Â Â Â Â Â Â </svg>
Â Â Â Â Â Â </button>
Â Â Â Â </div>
Â Â </div>
Â 
Â Â <div class="tab-content" id="math">
Â Â Â Â <div class="chat-box" id="mathBox"></div>
Â Â Â Â <div class="pending-preview" id="mathPreview"></div>
Â Â Â Â <div class="input-row">
Â Â Â Â Â Â <label class="icon-btn" for="mathFileInput" title="Táº£i áº£nh hoáº·c file">ğŸ“</label>
Â Â Â Â Â Â <input type="file" id="mathFileInput" accept="image/*,.pdf,.txt,.docx" hidden />
Â Â Â Â Â Â <label class="icon-btn" id="mathCameraBtn" title="Chá»¥p áº£nh">ğŸ“·</label>
Â Â Â Â Â Â <textarea id="mathPrompt" rows="1" placeholder="Nháº­p bÃ i toÃ¡n..."></textarea>
Â Â Â Â Â Â <button id="btnMath" class="send-btn" title="Giáº£i">
Â Â Â Â Â Â Â Â <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="white" viewBox="0 0 24 24">
Â Â Â Â Â Â Â Â Â Â <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12l14 7-7-7 7-7-14 7z"/>
Â Â Â Â Â Â Â Â </svg>
Â Â Â Â Â Â </button>
Â Â Â Â </div>
Â Â </div>
Â 
Â Â <div class="tab-content" id="video">
Â Â Â Â <div class="chat-box" id="videoBox"></div>
Â Â Â Â <div class="pending-preview" id="videoPreview"></div>
Â Â Â Â <div class="input-row">
Â Â Â Â Â Â <label class="icon-btn" for="videoFileInput" title="Táº£i áº£nh hoáº·c file">ğŸ“</label>
Â Â Â Â Â Â <input type="file" id="videoFileInput" accept="image/*" hidden />
Â Â Â Â Â Â <label class="icon-btn" id="videoCameraBtn" title="Chá»¥p áº£nh">ğŸ“·</label>
Â Â Â Â Â Â <textarea id="videoPrompt" rows="1" placeholder="Nháº­p mÃ´ táº£ video..."></textarea>
Â Â Â Â Â Â <button id="btnVideo" class="send-btn" title="Táº¡o Video">
Â Â Â Â Â Â Â Â <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="white" viewBox="0 0 24 24">
Â Â Â Â Â Â Â Â Â Â <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12l14 7-7-7 7-7-14 7z"/>
Â Â Â Â Â Â Â Â </svg>
Â Â Â Â Â Â </button>
Â Â Â Â </div>
Â Â </div>
</div>
Â 
<script>
// ============================================================
// âš™ï¸ CÃC BIáº¾N TOÃ€N Cá»¤C VÃ€ HÃ€M TIá»†N ÃCH (Chá»‰ Ä‘á»ƒ phá»¥c vá»¥ logic nÃºt áº¥n)
// ============================================================

const API_BASE_URL = window.location.origin;

let chatHistory = []; 
let currentAttachedImage = null; 

// HÃ m chung Ä‘á»ƒ thÃªm tin nháº¯n ngÆ°á»i dÃ¹ng (Cáº§n thiáº¿t Ä‘á»ƒ ngÆ°á»i dÃ¹ng tháº¥y há» Ä‘Ã£ nháº­p gÃ¬)
function appendUserMessage(boxId, message, imageBase64 = null) {
    const chatBox = document.getElementById(boxId);
    
    if (imageBase64) {
        const userImageBubble = document.createElement('div');
        userImageBubble.className = 'bubble user-bubble';
        const img = document.createElement('img');
        img.src = imageBase64;
        img.style.maxWidth = '100%';
        img.style.borderRadius = '8px';
        img.alt = 'áº¢nh ngÆ°á»i dÃ¹ng';
        chatBox.appendChild(userImageBubble);
        chatBox.appendChild(img);
    }
    
    if (message) {
        const userTextBubble = document.createElement('div');
        userTextBubble.className = 'bubble user-bubble';
        userTextBubble.innerHTML = message;
        chatBox.appendChild(userTextBubble);
    }
    
    chatBox.scrollTop = chatBox.scrollHeight;
}

// HÃ m chung Ä‘á»ƒ thÃªm tin nháº¯n Ä‘ang chá» pháº£n há»“i (Cáº§n thiáº¿t Ä‘á»ƒ hiá»ƒn thá»‹ loading)
function appendAIPendingMessage(boxId, text = "AI Ä‘ang xá»­ lÃ½...") {
    const chatBox = document.getElementById(boxId);
    const aiBubble = document.createElement('div');
    aiBubble.id = 'pending-ai-response';
    aiBubble.className = 'bubble ai-bubble';
    aiBubble.innerHTML = `<span style="font-style:italic;">${text}</span>`;
    chatBox.appendChild(aiBubble);
    chatBox.scrollTop = chatBox.scrollHeight;
    return aiBubble;
}

// HÃ m tiá»‡n Ã­ch táº¡o bubble lá»—i
function createErrorBubble(message) {
    const errorBubble = document.createElement('div');
    errorBubble.className = 'bubble ai-bubble';
    errorBubble.style.backgroundColor = '#991b1b';
    errorBubble.style.color = 'white';
    errorBubble.innerHTML = `Lá»—i: ${message}`;
    return errorBubble;
}

// HÃ m táº£i file vÃ  convert sang Base64
function handleFileSelect(event, previewId, fileType) {
    const file = event.target.files[0];
    if (!file) return;

    if (fileType === 'image' && !file.type.startsWith('image/')) {
        alert("Chá»‰ cháº¥p nháº­n file áº£nh cho tÃ¡c vá»¥ nÃ y.");
        event.target.value = null; 
        return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
        currentAttachedImage = e.target.result;
        const previewDiv = document.getElementById(previewId);
        if (previewDiv) previewDiv.innerHTML = `<img src="${currentAttachedImage}" alt="Preview" title="${file.name}">`;
    };
    reader.readAsDataURL(file);
}

// XÃ³a file Ä‘Ã­nh kÃ¨m
function clearAttachment(previewId) {
    currentAttachedImage = null;
    const previewDiv = document.getElementById(previewId);
    if (previewDiv) previewDiv.innerHTML = '';
}

// ============================================================
// ğŸ–¼ï¸ HÃ€M Táº O áº¢NH (CHá»¨C NÄ‚NG NÃšT Táº O áº¢NH)
// ============================================================
async function createImage() {
    const promptInput = document.getElementById('imagePrompt');
    const prompt = promptInput.value.trim();
    if (!prompt) {
        alert("Vui lÃ²ng nháº­p mÃ´ táº£ áº£nh.");
        return;
    }

    appendUserMessage('imageBox', `Táº¡o áº£nh: ${prompt}`);
    const pendingMsg = appendAIPendingMessage('imageBox', "Äang gá»­i yÃªu cáº§u táº¡o áº£nh...");
    promptInput.value = '';

    try {
        const response = await fetch(`${API_BASE_URL}/api/pollinations-image`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt })
        });

        const data = await response.json();
        pendingMsg.remove();
        const chatBox = document.getElementById('imageBox');

        if (response.ok && data.imageUrl) {
            const aiResponse = document.createElement('div');
            aiResponse.className = 'bubble ai-bubble';
            aiResponse.innerHTML = `âœ… áº¢nh Ä‘Ã£ Ä‘Æ°á»£c táº¡o.`;
            chatBox.appendChild(aiResponse);

            const img = document.createElement('img');
            img.className = 'generated-image';
            img.src = data.imageUrl;
            img.alt = 'áº¢nh Ä‘Æ°á»£c táº¡o bá»Ÿi AI';
            chatBox.appendChild(img);
        } else {
            const errorMsg = data.message || "âŒ Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh khi táº¡o áº£nh.";
            chatBox.appendChild(createErrorBubble(errorMsg));
        }
    } catch (error) {
        console.error("Lá»—i khi gá»i API Táº¡o áº¢nh:", error);
        pendingMsg.remove();
        document.getElementById('imageBox').appendChild(createErrorBubble("âŒ Lá»—i káº¿t ná»‘i Ä‘áº¿n Server."));
    }
    document.getElementById('imageBox').scrollTop = document.getElementById('imageBox').scrollHeight;
}

// ============================================================
// ğŸ’¬ğŸ§®ğŸï¸ HÃ€M Gá»¬I CHUNG (CHá»¨C NÄ‚NG CÃC NÃšT Gá»¬I/GIáº¢I/Táº O VIDEO)
// ============================================================
async function sendMessage(inputElementId, boxId, apiPath, isMath = false, isVideo = false) {
    const inputElement = document.getElementById(inputElementId);
    let message = inputElement.value.trim();
    const imageBase64 = currentAttachedImage;
    
    if (!message && !imageBase64) {
        alert("Vui lÃ²ng nháº­p ná»™i dung hoáº·c Ä‘Ã­nh kÃ¨m áº£nh.");
        return;
    }

    const language = document.getElementById('language-select').value;
    const historyToUse = isMath || isVideo ? [] : chatHistory; 

    // 1. ThÃªm tin nháº¯n/áº£nh ngÆ°á»i dÃ¹ng
    appendUserMessage(boxId, message, imageBase64);
    
    // 2. ThÃªm pending message
    let pendingText = isMath ? "Äang giáº£i bÃ i toÃ¡n..." : isVideo ? "Äang táº¡o chuyá»ƒn Ä‘á»™ng..." : "AI Ä‘ang tráº£ lá»i...";
    const pendingMsg = appendAIPendingMessage(boxId, pendingText);
    
    // 3. Reset input vÃ  attachment
    inputElement.value = '';
    const previewId = boxId.replace('Box', 'Preview');
    clearAttachment(previewId);
    
    // XÃ¢y dá»±ng payload
    let payload = { 
        language: language,
        image: imageBase64,
        prompt: message,
        question: message,
        message: message,
        history: historyToUse
    };

    let url = `${API_BASE_URL}${apiPath}`;

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        const data = await response.json();
        pendingMsg.remove();
        const chatBox = document.getElementById(boxId);

        if (response.ok) {
            
            // Xá»­ lÃ½ táº¡o Video (táº¡o GIF tá»« frames)
            if (isVideo && data.frames && data.frames.length > 0) {
                const aiResponse = document.createElement('div');
                aiResponse.className = 'bubble ai-bubble';
                aiResponse.innerHTML = `âœ… ÄÃ£ táº£i vá» ${data.frames.length} khung hÃ¬nh. Äang ghÃ©p GIF...`;
                chatBox.appendChild(aiResponse);
                
                // HÃ m renderGif Ä‘Æ°á»£c gá»i
                const gifData = await renderGif(data.frames, 512, 512); 
                if (gifData) {
                    const videoElement = document.createElement('img');
                    videoElement.className = 'generated-video';
                    videoElement.src = gifData;
                    videoElement.alt = 'Video (GIF) Ä‘Æ°á»£c táº¡o bá»Ÿi AI';
                    chatBox.appendChild(videoElement);
                } else {
                    chatBox.appendChild(createErrorBubble("âŒ Lá»—i khi render GIF trÃªn trÃ¬nh duyá»‡t."));
                }
            }
            
            // Xá»­ lÃ½ Chat vÃ  Math (dáº¡ng text)
            else if (data.response) {
                let aiResponseText = data.response;
                
                if (aiResponseText.startsWith("âŒ")) {
                    chatBox.appendChild(createErrorBubble(aiResponseText));
                    return;
                }

                const aiBubble = document.createElement('div');
                aiBubble.className = 'bubble ai-bubble';
                aiBubble.innerHTML = aiResponseText;
                chatBox.appendChild(aiBubble);

                if (!isMath && !isVideo) {
                    chatHistory.push({ role: 'user', text: message });
                    chatHistory.push({ role: 'assistant', text: aiResponseText });
                }

                if (isMath) {
                    // Gá»i MathJax Ä‘á»ƒ render cÃ´ng thá»©c toÃ¡n
                    MathJax.typesetPromise([chatBox]); 
                }
            }


        } else {
            const errorMsg = data.response || data.message || `âŒ Lá»—i HTTP ${response.status} tá»« Server.`;
            chatBox.appendChild(createErrorBubble(errorMsg));
        }
    } catch (error) {
        console.error(`Lá»—i khi gá»i API ${apiPath}:`, error);
        pendingMsg.remove();
        document.getElementById(boxId).appendChild(createErrorBubble("âŒ Lá»—i káº¿t ná»‘i Ä‘áº¿n Server."));
    }
    document.getElementById(boxId).scrollTop = document.getElementById(boxId).scrollHeight;
}


// ============================================================
// ğŸï¸ HÃ€M RENDER GIF (DÃ¹ng gif.js) - Cáº§n thiáº¿t cho Táº¡o Video
// ============================================================
function renderGif(frameDataUrls, width, height) {
    return new Promise((resolve) => {
        const gif = new GIF({
            workers: 2,
            quality: 10,
            width: width,
            height: height,
            workerScript: 'https://unpkg.com/gif.js@0.2.0/dist/gif.worker.js'
        });

        let loadedImages = 0;
        const totalFrames = frameDataUrls.length;
        
        frameDataUrls.forEach((dataUrl) => {
            const img = new Image();
            img.onload = () => {
                gif.addFrame(img, { delay: 150 });
                loadedImages++;
                if (loadedImages === totalFrames) {
                    gif.on('finished', (blob) => {
                        resolve(URL.createObjectURL(blob));
                    });
                    gif.render();
                }
            };
            img.onerror = () => {
                 loadedImages++;
                 if (loadedImages === totalFrames) {
                    gif.on('finished', (blob) => {
                        resolve(URL.createObjectURL(blob));
                    });
                    gif.render();
                 }
            };
            img.src = dataUrl;
        });

        // Timeout báº£o vá»‡
        setTimeout(() => {
            if (loadedImages < totalFrames) {
                resolve(null);
            }
        }, 15000);
    });
}


// Hiá»‡u á»©ng má»Ÿ Ä‘áº§u
function playIntro() {
Â Â const intro = document.getElementById("intro-screen");
Â Â const mainApp = document.getElementById("mainApp");
Â 
Â Â // Sau 6s áº©n intro vÃ  hiá»‡n app
Â Â setTimeout(() => {
Â Â Â Â intro.style.opacity = "0";
Â Â Â Â setTimeout(() => {
Â Â Â Â Â Â intro.style.display = "none";
Â Â Â Â Â Â mainApp.style.display = "block";
Â Â Â Â Â Â document.body.style.overflow = "auto";
Â Â Â Â }, 1800);
Â Â }, 6000);
}
playIntro();
Â 
/* Tabs */
const tabs=document.querySelectorAll(".tab-btn");
const contents=document.querySelectorAll(".tab-content");
tabs.forEach(tab=>tab.addEventListener("click",()=>{tabs.forEach(t=>t.classList.remove("active"));contents.forEach(c=>c.classList.remove("active"));tab.classList.add("active");document.getElementById(tab.dataset.tab).classList.add("active");
    // XÃ³a file Ä‘Ã­nh kÃ¨m khi chuyá»ƒn tab
    clearAttachment('chatPreview');
    clearAttachment('mathPreview');
    clearAttachment('videoPreview');
}));

/* Láº®NG NGHE Sá»° KIá»†N CÃC NÃšT (PHáº¦N Bá»” SUNG CHÃNH) */
document.getElementById('btnCreateImage').addEventListener('click', createImage);
document.getElementById('btnChat').addEventListener('click', () => sendMessage('chatInput', 'chatBox', '/api/chat'));
document.getElementById('btnMath').addEventListener('click', () => sendMessage('mathPrompt', 'mathBox', '/api/math', true));
document.getElementById('btnVideo').addEventListener('click', () => sendMessage('videoPrompt', 'videoBox', '/api/pollinations-frames', false, true));

/* Láº¯ng nghe file input */
document.getElementById('chatFileInput').addEventListener('change', (e) => handleFileSelect(e, 'chatPreview', 'file'));
document.getElementById('mathFileInput').addEventListener('change', (e) => handleFileSelect(e, 'mathPreview', 'file'));
document.getElementById('videoFileInput').addEventListener('change', (e) => handleFileSelect(e, 'videoPreview', 'image'));

/* Xá»­ lÃ½ UX: Auto-resize textarea vÃ  gá»­i tin nháº¯n báº±ng Enter */
document.querySelectorAll('textarea').forEach(textarea => {
    textarea.addEventListener('input', () => {
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
    });
    textarea.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            const tabId = document.querySelector('.tab-btn.active').dataset.tab;
            let btnId;

            if (tabId === 'image') {
                btnId = 'btnCreateImage';
            } else if (tabId === 'chat') {
                btnId = 'btnChat';
            } else if (tabId === 'math') {
                btnId = 'btnMath';
            } else if (tabId === 'video') {
                btnId = 'btnVideo';
            }

            if (btnId) {
                document.getElementById(btnId).click();
            }
        }
    });
});

/* Settings Modal */
document.getElementById('settings-btn').addEventListener('click', () => {
    const modal = document.getElementById('settings-modal');
    modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
});
</script>
</body>
</html>