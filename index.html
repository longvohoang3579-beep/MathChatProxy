<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üß† Tr·ª£ L√Ω AI ƒêa NƒÉng</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #121212; color: #e4e6eb; }
    .chat-container { background-color: #1e1e1e; }
    .bubble { padding: 10px 14px; border-radius: 18px; margin: 8px 0; max-width: 90%; word-wrap: break-word; }
    .user { background: #1e90ff; color: white; align-self: flex-end; }
    .ai { background: #3a3b3c; align-self: flex-start; }
    .highlight { background: #ffc400; color: #18191a; padding: 2px 4px; border-radius: 4px; }
  </style>
</head>
<body class="flex items-center justify-center h-screen">
  <div class="w-full max-w-lg bg-[#242526] rounded-lg shadow-2xl flex flex-col overflow-hidden">
    <header class="bg-gradient-to-r from-gray-800 to-black text-white p-4 text-center">
      <h1 class="text-xl font-extrabold">üß† Tr·ª£ L√Ω AI ƒêa NƒÉng</h1>
    </header>

    <nav class="flex justify-around bg-gray-900 p-2">
      <button id="tab-chat" onclick="switchView('chat')" class="tab-button active text-white font-semibold">üí¨ Chat</button>
      <button id="tab-image" onclick="switchView('image')" class="tab-button text-white font-semibold">üé® T·∫°o ·∫¢nh</button>
      <button id="tab-math" onclick="switchView('math')" class="tab-button text-white font-semibold">üßÆ Gi·∫£i To√°n</button>
    </nav>

    <div class="flex-grow relative">
      <!-- Chat -->
      <div id="chat-view" class="flex flex-col h-full">
        <main id="general-chat-box" class="overflow-y-auto p-4 flex flex-col flex-grow chat-container">
          <div class="bubble ai">Xin ch√†o! B·∫°n mu·ªën n√≥i chuy·ªán v·ªÅ g√¨ h√¥m nay?</div>
        </main>
        <footer class="p-3 bg-[#242526]">
          <div class="flex space-x-2">
            <input type="text" id="general-chat-input" placeholder="Nh·∫≠p tin nh·∫Øn..." class="flex-grow rounded-full px-4 py-2 bg-gray-700 text-white" onkeypress="if(event.key==='Enter') sendGeneralChatMessage()">
            <button onclick="sendGeneralChatMessage()" class="bg-blue-600 px-4 py-2 rounded-full text-white">G·ª≠i</button>
          </div>
        </footer>
      </div>

      <!-- Image -->
      <div id="image-view" class="p-4 hidden">
        <h2 class="text-lg font-bold text-center mb-4">üé® T·∫°o ·∫¢nh v·ªõi Pollinations</h2>
        <textarea id="image-prompt" rows="3" placeholder="V√≠ d·ª•: ch√∫ m√®o m∆∞·ªõp ƒë·ªôi m≈© phi h√†nh gia" class="w-full rounded-lg px-3 py-2 bg-gray-700 text-white mb-3"></textarea>
        <button onclick="generatePollinationsImage()" id="generate-image-btn" class="w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg font-semibold">T·∫°o ·∫£nh</button>
        <div id="image-result-container" class="mt-4 text-center"></div>
      </div>

      <!-- Math -->
      <div id="math-view" class="p-4 hidden">
        <main id="math-chat-box" class="overflow-y-auto p-4 flex flex-col flex-grow chat-container">
          <div class="bubble ai">G·ª≠i cho t√¥i b√†i to√°n b·∫±ng ch·ªØ ho·∫∑c h√¨nh ·∫£nh nh√©.</div>
        </main>
        <footer class="p-3 bg-[#242526]">
          <div class="flex space-x-2">
            <input type="text" id="math-text-input" placeholder="Nh·∫≠p b√†i to√°n..." class="flex-grow rounded-full px-4 py-2 bg-gray-700 text-white" onkeypress="if(event.key==='Enter') sendMathProblem()">
            <button onclick="sendMathProblem()" class="bg-blue-600 px-4 py-2 rounded-full text-white">G·ª≠i</button>
          </div>
        </footer>
      </div>
    </div>
  </div>

  <script>
    // Tab chuy·ªÉn ƒë·ªïi
    const views = { chat: document.getElementById('chat-view'), image: document.getElementById('image-view'), math: document.getElementById('math-view') };
    function switchView(v) {
      Object.values(views).forEach(x => x.classList.add('hidden'));
      views[v].classList.remove('hidden');
    }

    // API URL
    const API_CHAT = "/api/general-chat";
    const API_IMAGE = "/api/pollinations-image";
    const API_MATH = "/api/ask";

    // H√†m ƒë·ªãnh d·∫°ng chat
    function addMessage(box, content, role="ai") {
      const div = document.createElement("div");
      div.className = `bubble ${role}`;
      div.innerHTML = content;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }

    async function sendGeneralChatMessage() {
      const input = document.getElementById('general-chat-input');
      const text = input.value.trim();
      if (!text) return;
      addMessage(document.getElementById('general-chat-box'), text, 'user');
      input.value = "";
      const res = await fetch(API_CHAT, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ prompt: text }) });
      const data = await res.json();
      addMessage(document.getElementById('general-chat-box'), data.response);
    }

    // === Pollinations Image ===
    async function generatePollinationsImage() {
      const prompt = document.getElementById("image-prompt").value.trim();
      const btn = document.getElementById("generate-image-btn");
      const resultBox = document.getElementById("image-result-container");
      if (!prompt) return alert("Vui l√≤ng nh·∫≠p m√¥ t·∫£ ·∫£nh!");
      btn.disabled = true; btn.textContent = "ƒêang t·∫°o ·∫£nh...";
      resultBox.innerHTML = `<p class='text-gray-400'>ƒêang t·∫£i ·∫£nh...</p>`;
      try {
        const res = await fetch(API_IMAGE, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt })
        });
        const data = await res.json();
        resultBox.innerHTML = `<p class='text-sm text-gray-400 mb-2'>"${prompt}"</p><img src="${data.imageUrl}" class="rounded-lg mx-auto" alt="AI generated image">`;
      } catch (err) {
        resultBox.innerHTML = `<p class='text-red-400'>L·ªói: ${err.message}</p>`;
      } finally {
        btn.disabled = false; btn.textContent = "T·∫°o ·∫£nh";
      }
    }

    // === Math ===
    async function sendMathProblem() {
      const text = document.getElementById('math-text-input').value.trim();
      const box = document.getElementById('math-chat-box');
      if (!text) return;
      addMessage(box, text, 'user');
      const res = await fetch(API_MATH, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ question: text }) });
      const data = await res.json();
      addMessage(box, data.response);
    }
  </script>
</body>
</html>
