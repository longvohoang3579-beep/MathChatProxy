<script>
// Hi·ªáu ·ª©ng m·ªü ƒë·∫ßu
function playIntro() {
  const intro = document.getElementById("intro-screen");
  const mainApp = document.getElementById("mainApp");

  // Sau 6s ·∫©n intro v√† hi·ªán app
  setTimeout(() => {
    intro.style.opacity = "0";
    setTimeout(() => {
      intro.style.display = "none";
      mainApp.style.display = "block";
      document.body.style.overflow = "auto";
    }, 1800);
  }, 6000);
}
playIntro();

/* Tabs */
const tabs=document.querySelectorAll(".tab-btn");
const contents=document.querySelectorAll(".tab-content");
tabs.forEach(tab=>tab.addEventListener("click",()=>{
  tabs.forEach(t=>t.classList.remove("active"));
  contents.forEach(c=>c.classList.remove("active"));
  tab.classList.add("active");
  document.getElementById(tab.dataset.tab).classList.add("active");
}));

/* ========== X·ª¨ L√ù API 4 N√öT ========== */

// --- Chat (üí¨) ---
document.getElementById("btnChat").addEventListener("click", async () => {
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  const box = document.getElementById("chatBox");
  if (!text) return;

  // Hi·ªÉn th·ªã tin ng∆∞·ªùi d√πng
  const userBubble = document.createElement("div");
  userBubble.className = "bubble user-bubble";
  userBubble.textContent = text;
  box.appendChild(userBubble);
  input.value = "";

  // G·ª≠i API
  try {
    const res = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text }),
    });
    const data = await res.json();

    // Hi·ªÉn th·ªã ph·∫£n h·ªìi
    const aiBubble = document.createElement("div");
    aiBubble.className = "bubble ai-bubble";
    aiBubble.innerHTML = data.reply || "Kh√¥ng c√≥ ph·∫£n h·ªìi.";
    box.appendChild(aiBubble);
    box.scrollTop = box.scrollHeight;
  } catch (err) {
    console.error(err);
  }
});

// --- Gi·∫£i To√°n (üßÆ) ---
document.getElementById("btnMath").addEventListener("click", async () => {
  const input = document.getElementById("mathPrompt");
  const text = input.value.trim();
  const box = document.getElementById("mathBox");
  if (!text) return;

  const userBubble = document.createElement("div");
  userBubble.className = "bubble user-bubble";
  userBubble.textContent = text;
  box.appendChild(userBubble);
  input.value = "";

  try {
    const res = await fetch("/api/math", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question: text }),
    });
    const data = await res.json();

    const aiBubble = document.createElement("div");
    aiBubble.className = "bubble ai-bubble";
    aiBubble.innerHTML = data.answer || "Kh√¥ng c√≥ k·∫øt qu·∫£.";
    box.appendChild(aiBubble);
    box.scrollTop = box.scrollHeight;
    if (window.MathJax) MathJax.typeset();
  } catch (err) {
    console.error(err);
  }
});

// --- T·∫°o ·∫¢nh (üñºÔ∏è) ---
document.getElementById("btnCreateImage").addEventListener("click", async () => {
  const input = document.getElementById("imagePrompt");
  const text = input.value.trim();
  const box = document.getElementById("imageBox");
  if (!text) return;

  const userBubble = document.createElement("div");
  userBubble.className = "bubble user-bubble";
  userBubble.textContent = text;
  box.appendChild(userBubble);
  input.value = "";

  try {
    const res = await fetch("/api/image", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt: text }),
    });
    const data = await res.json();

    const aiBubble = document.createElement("div");
    aiBubble.className = "bubble ai-bubble";
    if (data.imageUrl) {
      const img = document.createElement("img");
      img.src = data.imageUrl;
      img.className = "generated-image";
      aiBubble.appendChild(img);
    } else {
      aiBubble.textContent = "Kh√¥ng th·ªÉ t·∫°o ·∫£nh.";
    }
    box.appendChild(aiBubble);
    box.scrollTop = box.scrollHeight;
  } catch (err) {
    console.error(err);
  }
});

// --- T·∫°o Video (üéûÔ∏è) ---
document.getElementById("btnVideo").addEventListener("click", async () => {
  const input = document.getElementById("videoPrompt");
  const text = input.value.trim();
  const box = document.getElementById("videoBox");
  if (!text) return;

  const userBubble = document.createElement("div");
  userBubble.className = "bubble user-bubble";
  userBubble.textContent = text;
  box.appendChild(userBubble);
  input.value = "";

  try {
    const res = await fetch("/api/video", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt: text }),
    });
    const data = await res.json();

    const aiBubble = document.createElement("div");
    aiBubble.className = "bubble ai-bubble";
    if (data.videoUrl) {
      const video = document.createElement("video");
      video.src = data.videoUrl;
      video.controls = true;
      video.autoplay = false;
      video.className = "generated-video";
      aiBubble.appendChild(video);
    } else {
      aiBubble.textContent = "Kh√¥ng th·ªÉ t·∫°o video.";
    }
    box.appendChild(aiBubble);
    box.scrollTop = box.scrollHeight;
  } catch (err) {
    console.error(err);
  }
});
</script>
