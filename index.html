<!DOCTYPE html>
<html lang="vi">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>AI Assistant</title>
Â  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
Â  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


Â  <style>
Â  Â  /* -------------------------------------- */
Â  Â  /* MÃ u sáº¯c vÃ  Font Body        */
Â  Â  /* -------------------------------------- */
Â  Â  body {
Â  Â  Â  background-color: #1a1a2e; /* Deep purple-blue */
Â  Â  Â  color: #e0e0e0; /* Off-white for text */
Â  Â  Â  font-family: 'Inter', sans-serif; /* Modern, clean font */
Â  Â  Â  margin: 0;
Â  Â  Â  padding-bottom: 60px;
Â  Â  }

Â  Â  /* Main container */
Â  Â  .main-container {
Â  Â  Â  background-color: #242640; /* Slightly lighter than body, deep blue */
Â  Â  Â  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); /* Stronger shadow */
Â  Â  Â  border: 1px solid rgba(110, 89, 230, 0.2); /* Subtle border */
Â  Â  }

Â  Â  /* -------------------------------------- */
Â  Â  /* Tab Buttons             */
Â  Â  /* -------------------------------------- */
Â  Â  .tab-btn {
Â  Â  Â  flex: 1;
Â  Â  Â  padding: 1rem 0.75rem; /* Increased padding */
Â  Â  Â  cursor: pointer;
Â  Â  Â  text-align: center;
Â  Â  Â  border-bottom: 3px solid transparent;
Â  Â  Â  transition: all 0.2s ease-in-out; /* Smooth transition */
Â  Â  Â  font-weight: 600; /* Semi-bold */
Â  Â  Â  color: #b0b0c0; /* Lighter gray */
Â  Â  }
Â  Â  .tab-btn:hover {
Â  Â  Â  color: #8c7ae6; /* Purple on hover */
Â  Â  Â  border-color: rgba(140, 122, 230, 0.5);
Â  Â  }
Â  Â  .tab-btn.active {
Â  Â  Â  border-color: #6a4cff; /* Vibrant purple */
Â  Â  Â  color: #6a4cff;
Â  Â  Â  background-color: rgba(106, 76, 255, 0.1); /* Subtle active background */
Â  Â  }

Â  Â  /* -------------------------------------- */
Â  Â  /* Input/Textarea          */
Â  Â  /* -------------------------------------- */
Â  Â  textarea, select {
Â  Â  Â  background-color: #3e2b5e; /* Darker purple for inputs */
Â  Â  Â  border: 1px solid #6a4cff; /* Purple border */
Â  Â  Â  color: #e0e0e0;
Â  Â  Â  padding: 0.75rem;
Â  Â  Â  border-radius: 0.75rem; /* More rounded */
Â  Â  Â  transition: border-color 0.2s ease-in-out;
Â  Â  }
Â  Â  textarea:focus, select:focus {
Â  Â  Â  outline: none;
Â  Â  Â  border-color: #a78bfa; /* Lighter purple on focus */
Â  Â  Â  box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.3);
Â  Â  }
Â  Â  /* Placeholder color */
Â  Â  textarea::placeholder {
Â  Â  Â  color: #9ca3af;
Â  Â  }

Â  Â  /* -------------------------------------- */
Â  Â  /* Buttons               */
Â  Â  /* -------------------------------------- */
Â  Â  button {
Â  Â  Â  padding: 0.75rem 1.5rem; /* Increased padding */
Â  Â  Â  border-radius: 0.75rem; /* More rounded */
Â  Â  Â  font-weight: 700; /* Bold */
Â  Â  Â  transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
Â  Â  Â  letter-spacing: 0.05em; /* Slightly spaced letters */
Â  Â  }
Â  Â  #btnCreateImage {
Â  Â  Â  background-color: #34d399; /* Emerald green */
Â  Â  Â  color: #1a1a2e;
Â  Â  }
Â  Â  #btnCreateImage:hover {
Â  Â  Â  background-color: #10b981; /* Darker green */
Â  Â  Â  transform: translateY(-2px);
Â  Â  }
Â  Â  #btnChat {
Â  Â  Â  background-color: #6a4cff; /* Vibrant purple */
Â  Â  Â  color: white;
Â  Â  }
Â  Â  #btnChat:hover {
Â  Â  Â  background-color: #5d3dfa; /* Darker purple */
Â  Â  Â  transform: translateY(-2px);
Â  Â  }
Â  Â  #btnMath {
Â  Â  Â  background-color: #fbbf24; /* Amber yellow */
Â  Â  Â  color: #1a1a2e;
Â  Â  }
Â  Â  #btnMath:hover {
Â  Â  Â  background-color: #f59e0b; /* Darker amber */
Â  Â  Â  transform: translateY(-2px);
Â  Â  }
Â  Â  button:disabled {
Â  Â  Â  opacity: 0.6;
Â  Â  Â  cursor: not-allowed;
Â  Â  Â  transform: none;
Â  Â  }

Â  Â  /* -------------------------------------- */
Â  Â  /* Image Container          */
Â  Â  /* -------------------------------------- */
Â  Â  .generated-image-container {
Â  Â  Â  position: relative;
Â  Â  Â  text-align: center;
Â  Â  Â  max-width: 550px;
Â  Â  Â  margin: 0 auto;
Â  Â  Â  background-color: #3e2b5e;
Â  Â  Â  padding: 1rem;
Â  Â  Â  border-radius: 1rem;
Â  Â  Â  border: 1px solid #6a4cff;
Â  Â  Â  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
Â  Â  }
Â  Â  .generated-image-container img {
Â  Â  Â  border-radius: 0.75rem;
Â  Â  }
Â  Â  .image-watermark-cover {
Â  Â  Â  background: linear-gradient(90deg, #242640, #242640); /* Match main container */
Â  Â  Â  opacity: 0.8; /* Slightly visible */
Â  Â  }

Â  Â  /* -------------------------------------- */
Â  Â  /* Chat Bubbles           */
Â  Â  /* -------------------------------------- */
Â  Â  .chat-history {
Â  Â  Â  background-color: #1a1a2e; /* Darker background for chat history */
Â  Â  Â  border-radius: 0.75rem;
Â  Â  Â  padding: 0.5rem;
Â  Â  Â  border: 1px solid rgba(110, 89, 230, 0.2);
Â  Â  }
Â  Â  .chat-message {
Â  Â  Â  padding: 0.75rem 1.25rem; /* More padding */
Â  Â  Â  border-radius: 1.25rem; /* More rounded */
Â  Â  Â  margin-bottom: 0.75rem; /* More space */
Â  Â  Â  max-width: 80%; /* Slightly smaller max width */
Â  Â  Â  word-wrap: break-word; /* Ensure long words wrap */
Â  Â  Â  line-height: 1.5; /* Better readability */
Â  Â  }
Â  Â  .user-message {
Â  Â  Â  background-color: #6a4cff; /* Vibrant purple */
Â  Â  Â  color: white;
Â  Â  Â  align-self: flex-end;
Â  Â  Â  margin-left: auto;
Â  Â  Â  border-bottom-right-radius: 0.5rem; /* Slightly less rounded on one corner */
Â  Â  }
Â  Â  .ai-message {
Â  Â  Â  background-color: #3e2b5e; /* Darker purple for AI */
Â  Â  Â  color: #e0e0e0;
Â  Â  Â  align-self: flex-start;
Â  Â  Â  margin-right: auto;
Â  Â  Â  border-bottom-left-radius: 0.5rem; /* Slightly less rounded on one corner */
Â  Â  }

Â  Â  /* -------------------------------------- */
Â  Â  /* Highlight              */
Â  Â  /* -------------------------------------- */
Â  Â  .highlight {
Â  Â  Â  background-color: #fde047; /* Bright yellow */
Â  Â  Â  color: #1a1a2e; /* Dark text for contrast */
Â  Â  Â  padding: 2px 5px;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  font-weight: 600;
Â  Â  }

Â  Â  /* -------------------------------------- */
Â  Â  /* Settings Button/Modal  */
Â  Â  /* -------------------------------------- */
Â  Â  #settings-btn {
Â  Â  Â  background: #3e2b5e; /* Match AI message/input */
Â  Â  Â  color: #a78bfa; /* Light purple icon */
Â  Â  Â  padding: 0.75rem 1rem; /* Bigger button */
Â  Â  Â  border-radius: 0.75rem; /* More rounded */
Â  Â  Â  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
Â  Â  Â  transition: all 0.2s ease-in-out;
Â  Â  }
Â  Â  #settings-btn:hover {
Â  Â  Â  background: #4b3270;
Â  Â  Â  color: #e0e0e0;
Â  Â  Â  transform: translateY(-2px);
Â  Â  }
Â  Â  #settings-modal {
Â  Â  Â  background: #2f2c4a; /* Slightly lighter than main container */
Â  Â  Â  border: 1px solid #6a4cff;
Â  Â  Â  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
Â  Â  Â  transform-origin: top right;
Â  Â  Â  animation: fadeInScale 0.2s ease-out forwards;
Â  Â  }
Â  Â  @keyframes fadeInScale {
Â  Â  Â  from { opacity: 0; transform: scale(0.9) translateY(-10px); }
Â  Â  Â  to { opacity: 1; transform: scale(1) translateY(0); }
Â  Â  }
Â  Â  #settings-modal.hidden {
Â  Â  Â  animation: fadeOutScale 0.2s ease-in forwards;
Â  Â  }
Â  Â  @keyframes fadeOutScale {
Â  Â  Â  from { opacity: 1; transform: scale(1) translateY(0); }
Â  Â  Â  to { opacity: 0; transform: scale(0.9) translateY(-10px); }
Â  Â  }

Â  Â  /* MathJax specific styles */
Â  Â  .math-container .MJX-TEX {
Â  Â  Â  color: #a78bfa !important; /* Math equations in a light purple */
Â  Â  }
Â  Â  .math-container {
Â  Â  Â  background-color: #1a1a2e; /* Dark background for math result */
Â  Â  Â  padding: 1rem;
Â  Â  Â  border-radius: 0.75rem;
Â  Â  Â  border: 1px dashed rgba(167, 139, 250, 0.3); /* Dashed purple border */
Â  Â  Â  margin-top: 1rem;
Â  Â  Â  font-size: 1.1em;
Â  Â  }
Â  </style>
</head>

<body class="min-h-screen flex flex-col items-center p-5 relative">
Â  Â  <div id="settings-btn" class="absolute top-4 right-4 text-xl cursor-pointer">
Â  Â  Â  <i class="fas fa-cog"></i> Â  Â  </div>

Â  Â  <div id="settings-modal" class="absolute hidden top-16 right-4 p-5 rounded-lg w-72">
Â  Â  Â  <h3 class="font-bold mb-4 text-xl text-center text-[#a78bfa]">AI Settings</h3>
Â  Â  Â  <div>
Â  Â  Â  Â  <label for="language-select" class="block text-sm font-medium mb-2 text-gray-300">NgÃ´n ngá»¯ Chat:</label>
Â  Â  Â  Â  <select id="language-select" class="w-full p-2 rounded-md bg-gray-700 text-white border border-gray-600 focus:ring-2 focus:ring-[#a78bfa]">
Â  Â  Â  Â  Â  <option value="vi">Tiáº¿ng Viá»‡t</option>
Â  Â  Â  Â  Â  <option value="en">English (Tiáº¿ng Anh)</option>
Â  Â  Â  Â  Â  <option value="zh-CN">ç®€ä½“ä¸­æ–‡ (Tiáº¿ng Trung Giáº£n thá»ƒ)</option>
Â  Â  Â  Â  </select>
Â  Â  Â  </div>
Â  Â  </div>

Â  <div class="w-full max-w-3xl main-container rounded-2xl">
Â  Â  <div class="flex border-b border-gray-700">
Â  Â  Â  <div class="tab-btn active" id="tab-image">ğŸ–¼ï¸ Táº¡o áº¢nh</div>
Â  Â  Â  <div class="tab-btn" id="tab-chat">ğŸ’¬ Chat</div>
Â  Â  Â  <div class="tab-btn" id="tab-math">ğŸ§® Giáº£i ToÃ¡n</div>
Â  Â  </div>

Â  Â  <div id="content-image" class="p-6">
Â  Â  Â  <textarea id="imagePrompt" rows="3" class="w-full mt-2"
Â  Â  Â  Â  placeholder="Nháº­p mÃ´ táº£ áº£nh báº¡n muá»‘n táº¡o (vÃ­ dá»¥: 'má»™t con mÃ¨o mÃ¡y ngá»“i trÃªn máº·t trÄƒng vá»›i mÅ© phi hÃ nh gia')..."></textarea>
Â  Â  Â  <button id="btnCreateImage" class="w-full mt-4">Táº¡o áº¢nh</button>
Â  Â  Â  <div id="imageResult" class="mt-6 text-center text-gray-400"></div>
Â  Â  </div>

Â  Â  <div id="content-chat" class="p-6 hidden flex flex-col h-[500px]">
Â  Â  Â  <div id="chatHistory" class="flex-grow overflow-y-auto mb-4 chat-history flex flex-col">
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  <textarea id="chatPrompt" rows="2" class="w-full"
Â  Â  Â  Â  placeholder="Nháº­p tin nháº¯n cá»§a báº¡n..."></textarea>
Â  Â  Â  <button id="btnChat" class="w-full mt-4">Gá»­i Chat</button>
Â  Â  </div>

Â  Â  <div id="content-math" class="p-6 hidden">
Â  Â  Â  <textarea id="mathPrompt" rows="3" class="w-full"
Â  Â  Â  Â  placeholder="Nháº­p bÃ i toÃ¡n cáº§n giáº£i (vÃ­ dá»¥: 'Giáº£i phÆ°Æ¡ng trÃ¬nh x^2 - 4x + 4 = 0')..."></textarea>
Â  Â  Â  <button id="btnMath" class="w-full mt-4">Giáº£i ToÃ¡n</button>
Â  Â  Â  <div id="mathResult" class="mt-6 text-gray-300 math-container"></div>
Â  Â  Â  <p class="text-xs text-gray-500 mt-4 text-center">
Â  Â  Â  Â  *LÆ°u Ã½: Pháº§n giáº£i toÃ¡n Ä‘Æ°á»£c tá»‘i Æ°u Ä‘á»ƒ tráº£ lá»i ngáº¯n gá»n, táº­p trung vÃ o káº¿t quáº£ vÃ  sá»­ dá»¥ng LaTeX.*
Â  Â  Â  </p>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  // Biáº¿n toÃ n cá»¥c Ä‘á»ƒ lÆ°u lá»‹ch sá»­ chat
Â  Â  let chatHistory = [];
Â  Â  
Â  Â  // ----- Xá»­ lÃ½ Settings NgÃ´n ngá»¯ -----
Â  Â  const settingsBtn = document.getElementById("settings-btn");
Â  Â  const settingsModal = document.getElementById("settings-modal");
Â  Â  const langSelect = document.getElementById("language-select");

Â  Â  // Táº£i ngÃ´n ngá»¯ Ä‘Ã£ lÆ°u, máº·c Ä‘á»‹nh lÃ  Tiáº¿ng Viá»‡t
Â  Â  let currentLang = localStorage.getItem('geminiChatLanguage') || 'vi';
Â  Â  langSelect.value = currentLang;

Â  Â  settingsBtn.addEventListener('click', () => {
Â  Â  Â  settingsModal.classList.toggle('hidden');
Â  Â  });

Â  Â  // ÄÃ³ng modal khi click ra ngoÃ i
Â  Â  document.addEventListener('click', (event) => {
Â  Â  Â  if (!settingsModal.contains(event.target) && !settingsBtn.contains(event.target)) {
Â  Â  Â  Â  settingsModal.classList.add('hidden');
Â  Â  Â  }
Â  Â  });


Â  Â  langSelect.addEventListener('change', (e) => {
Â  Â  Â  currentLang = e.target.value;
Â  Â  Â  localStorage.setItem('geminiChatLanguage', currentLang);
Â  Â  Â  // Khi Ä‘á»•i ngÃ´n ngá»¯, xÃ³a lá»‹ch sá»­ chat Ä‘á»ƒ báº¯t Ä‘áº§u cuá»™c trÃ² chuyá»‡n má»›i
Â  Â  Â  chatHistory = [];
Â  Â  Â  document.getElementById("chatHistory").innerHTML = '';
Â  Â  Â  settingsModal.classList.add('hidden');
Â  Â  Â  alert(`ÄÃ£ chuyá»ƒn ngÃ´n ngá»¯ sang: ${e.target.options[e.target.selectedIndex].text}. Vui lÃ²ng báº¯t Ä‘áº§u cuá»™c trÃ² chuyá»‡n má»›i.`);
Â  Â  });

Â  Â  // HÃ m chuyá»ƒn Ä‘á»•i Markdown cÆ¡ báº£n vÃ  tháº» <mark> sang HTML
Â  Â  function markdownToHtml(text) {
Â  Â  Â  // 1. Chuyá»ƒn Ä‘á»•i **in Ä‘áº­m**
Â  Â  Â  let html = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
Â  Â  Â  // 2. Chuyá»ƒn Ä‘á»•i xuá»‘ng dÃ²ng
Â  Â  Â  html = html.replace(/\n/g, '<br>');
Â  Â  Â  return html;
Â  Â  }

Â  Â  // HÃ m hiá»ƒn thá»‹ tin nháº¯n trong khung chat
Â  Â  function appendMessage(sender, text) {
Â  Â  Â  const historyDiv = document.getElementById("chatHistory");
Â  Â  Â  const msgDiv = document.createElement("div");
Â  Â  Â  const htmlContent = markdownToHtml(text);
Â  Â  Â  
Â  Â  Â  msgDiv.classList.add("chat-message");
Â  Â  Â  
Â  Â  Â  if (sender === 'user') {
Â  Â  Â  Â  msgDiv.classList.add("user-message");
Â  Â  Â  Â  msgDiv.innerHTML = htmlContent;
Â  Â  Â  } else {
Â  Â  Â  Â  msgDiv.classList.add("ai-message");
Â  Â  Â  Â  msgDiv.innerHTML = htmlContent;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  historyDiv.appendChild(msgDiv);
Â  Â  Â  // Cuá»™n xuá»‘ng dÆ°á»›i cÃ¹ng
Â  Â  Â  historyDiv.scrollTop = historyDiv.scrollHeight;
Â  Â  }

Â  Â  // ----- Tab chuyá»ƒn Ä‘á»•i (Giá»¯ nguyÃªn) -----
Â  Â  const tabs = document.querySelectorAll(".tab-btn");
Â  Â  const contents = {
Â  Â  Â  "tab-image": document.getElementById("content-image"),
Â  Â  Â  "tab-chat": document.getElementById("content-chat"),
Â  Â  Â  "tab-math": document.getElementById("content-math")
Â  Â  };

Â  Â  tabs.forEach(tab => {
Â  Â  Â  tab.addEventListener("click", () => {
Â  Â  Â  Â  tabs.forEach(t => t.classList.remove("active"));
Â  Â  Â  Â  Object.values(contents).forEach(c => c.classList.add("hidden"));
Â  Â  Â  Â  tab.classList.add("active");
Â  Â  Â  Â  contents[tab.id].classList.remove("hidden");
Â  Â  Â  });
Â  Â  });

Â  Â  // ğŸ–¼ï¸ Pollinations
Â  Â  document.getElementById("btnCreateImage").addEventListener("click", async () => {
Â  Â  Â  const prompt = document.getElementById("imagePrompt").value.trim();
Â  Â  Â  const resDiv = document.getElementById("imageResult");
Â  Â  Â  if (!prompt) {
Â  Â  Â  Â  resDiv.innerHTML = `<p class='text-red-400'>Vui lÃ²ng nháº­p mÃ´ táº£ áº£nh.</p>`;
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  resDiv.innerHTML = `<p class='text-green-400 font-bold animate-pulse'>ÄANG Táº O áº¢NH...</p>`; 
Â  Â  Â  
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch("/api/pollinations-image", {
Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  headers: { "Content-Type": "application/json" },
Â  Â  Â  Â  Â  body: JSON.stringify({ prompt })
Â  Â  Â  Â  });
Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  if (data.imageUrl) {
Â  Â  Â  Â  Â  resDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="generated-image-container">
Â  Â  Â  Â  Â  Â  Â  <img src="${data.imageUrl}" class="rounded-lg w-full">
Â  Â  Â  Â  Â  Â  Â  <div class="image-watermark-cover"></div>
Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  resDiv.innerHTML = `<p class='text-red-400'>${data.message || 'Lá»—i khi táº¡o áº£nh.'}</p>`;
Â  Â  Â  Â  }
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  resDiv.innerHTML = `<p class='text-red-400'>Lá»—i káº¿t ná»‘i Ä‘áº¿n server.</p>`;
Â  Â  Â  }
Â  Â  });

Â  Â  // ğŸ’¬ Chat (ÄÃƒ Cáº¬P NHáº¬T Gá»¬I NGÃ”N NGá»®)
Â  Â  document.getElementById("btnChat").addEventListener("click", async () => {
Â  Â  Â  const prompt = document.getElementById("chatPrompt").value.trim();
Â  Â  Â  const historyDiv = document.getElementById("chatHistory");
Â  Â  Â  const btn = document.getElementById("btnChat");

Â  Â  Â  if (!prompt) return;

Â  Â  Â  appendMessage('user', prompt);
Â  Â  Â  chatHistory.push({ role: "user", text: prompt });
Â  Â  Â  document.getElementById("chatPrompt").value = '';

Â  Â  Â  const statusDiv = document.createElement("div");
Â  Â  Â  statusDiv.classList.add("ai-message", "text-gray-400", "font-bold", "animate-pulse");
Â  Â  Â  statusDiv.id = "chatStatus";
Â  Â  Â  statusDiv.textContent = "ÄANG TRáº¢ Lá»œI...";
Â  Â  Â  historyDiv.appendChild(statusDiv);
Â  Â  Â  historyDiv.scrollTop = historyDiv.scrollHeight;
Â  Â  Â  btn.disabled = true;

Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch("/api/chat", {
Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  headers: { "Content-Type": "application/json" },
Â  Â  Â  Â  Â  // Gá»¬I NGÃ”N NGá»® ÄÃƒ CHá»ŒN LÃŠN SERVER
Â  Â  Â  Â  Â  body: JSON.stringify({ 
Â  Â  Â  Â  Â  Â  message: prompt, 
Â  Â  Â  Â  Â  Â  history: chatHistory,
Â  Â  Â  Â  Â  Â  language: currentLang 
Â  Â  Â  Â  Â  })
Â  Â  Â  Â  });
Â  Â  Â  Â  const data = await res.json();

Â  Â  Â  Â  statusDiv.remove();

Â  Â  Â  Â  const reply = data.response || "âŒ KhÃ´ng cÃ³ pháº£n há»“i tá»« Gemini.";
Â  Â  Â  Â  
Â  Â  Â  Â  appendMessage('assistant', reply);
Â  Â  Â  Â  chatHistory.push({ role: "assistant", text: reply }); 
Â  Â  Â  Â  
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  statusDiv.textContent = "âŒ Lá»—i káº¿t ná»‘i Ä‘áº¿n server.";
Â  Â  Â  Â  console.error(err);
Â  Â  Â  } finally {
Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  }
Â  Â  });

Â  Â  // ğŸ§® Math
Â  Â  document.getElementById("btnMath").addEventListener("click", async () => {
Â  Â  Â  const question = document.getElementById("mathPrompt").value.trim();
Â  Â  Â  const resDiv = document.getElementById("mathResult");
Â  Â  Â  const btn = document.getElementById("btnMath");

Â  Â  Â  if (!question) {
Â  Â  Â  Â  resDiv.innerHTML = `<p class='text-red-400'>Vui lÃ²ng nháº­p bÃ i toÃ¡n.</p>`;
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  resDiv.innerHTML = `<p class='text-yellow-400 font-bold animate-pulse'>ÄANG GIáº¢I TOÃN...</p>`;
Â  Â  Â  btn.disabled = true;

Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch("/api/math", {
Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  headers: { "Content-Type": "application/json" },
Â  Â  Â  Â  Â  body: JSON.stringify({ question })
Â  Â  Â  Â  });
Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  
Â  Â  Â  Â  const rawResponse = data.response || "âŒ KhÃ´ng cÃ³ pháº£n há»“i tá»« Gemini.";
Â  Â  Â  Â  
Â  Â  Â  Â  let htmlContent = markdownToHtml(rawResponse);

Â  Â  Â  Â  resDiv.innerHTML = htmlContent;
Â  Â  Â  Â  
Â  Â  Â  Â  MathJax.typesetPromise([resDiv]).catch((err) => console.error("MathJax Error:", err));

Â  Â  Â  } catch (err) {
Â  Â  Â  Â  resDiv.innerHTML = `<p class='text-red-400'>Lá»—i káº¿t ná»‘i Ä‘áº¿n server.</p>`;
Â  Â  Â  Â  console.error(err);
Â  Â  Â  } finally {
Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  }
Â  Â  });
Â  </script>
</body>
</html>