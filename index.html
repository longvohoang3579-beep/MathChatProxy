<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Assistant Pro</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<style>
body {
Â  background-color:#0f0f13; color:#fff; font-family:'Segoe UI',sans-serif;
Â  margin:0; padding:0; overflow:hidden;
}

/* ---------- Intro ---------- */
#intro-screen {
Â  position: fixed;
Â  top:0; left:0; width:100%; height:100vh;
Â  background: radial-gradient(circle at center, #1a1c29 0%, #0a0a0a 80%);
Â  overflow:hidden;
Â  display:flex; align-items:center; justify-content:center;
Â  flex-direction:column; z-index:1000;
Â  transition:opacity 1.8s ease;
}
#intro-bg {
Â  position:absolute; top:0; left:0; width:100%; height:100%;
Â  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.07) 0%, transparent 60%),
Â  Â  Â  Â  Â  Â  Â  radial-gradient(circle at 70% 70%, rgba(255,255,255,0.05) 0%, transparent 60%),
Â  Â  Â  Â  Â  Â  Â  radial-gradient(circle at 50% 100%, rgba(122, 255, 255, 0.08) 0%, transparent 70%);
Â  animation: glowMove 10s ease-in-out infinite alternate;
Â  filter: blur(50px);
}
@keyframes glowMove {
Â  0% { transform: scale(1) translate(0, 0); }
Â  100% { transform: scale(1.2) translate(20px, -20px); }
}
#intro-text {
Â  position:relative;
Â  color:#facc15;
Â  font-size:2.3rem; font-weight:bold;
Â  text-shadow:0 0 20px rgba(255, 255, 150, 0.8), 0 0 40px rgba(255,255,255,0.4);
Â  animation: floatText 3s ease-in-out infinite alternate;
}
@keyframes floatText {
Â  0% { transform: translateY(0); opacity:1; }
Â  100% { transform: translateY(-10px); opacity:0.95; }
}
#intro-subtext {
Â  color:#e0e7ff;
Â  margin-top:1rem;
Â  font-size:1.1rem;
Â  opacity:0.85;
Â  text-shadow:0 0 10px rgba(255,255,255,0.3);
Â  animation: fadeIn 3s ease-in-out 1.5s forwards;
Â  opacity:0;
}
@keyframes fadeIn {
Â  from { opacity:0; }
Â  to { opacity:1; }
}

/* ---------- Main Container ---------- */
.container {max-width:900px;margin:2rem auto;background:#1a1c29;border-radius:1.5rem;padding:1.5rem;box-shadow:0 15px 30px rgba(0,0,0,0.7);display:none;}
.tabs {display:flex;border-bottom:2px solid #333;margin-bottom:1rem;}
.tab-btn {flex:1;text-align:center;padding:1rem;cursor:pointer;color:#aaa;font-weight:bold;transition:all 0.2s;}
.tab-btn.active {color:#fff;border-bottom:3px solid #facc15;}
.tab-content {display:none;}
.tab-content.active {display:block;}
.chat-box {background:#111827;border-radius:12px;padding:1rem;height:400px;overflow-y:auto;display:flex;flex-direction:column; scroll-behavior: smooth;}
.bubble {max-width:80%;padding:10px 14px;border-radius:12px;margin-bottom:10px;line-height:1.5;word-wrap:break-word;white-space:pre-wrap;}
.user-bubble {background:#2563eb;align-self:flex-end;color:white;border-bottom-right-radius:2px;}
.ai-bubble {background:#374151;align-self:flex-start;color:#e5e7eb;border-bottom-left-radius:2px;}

/* CSS Má»šI: áº¨n táº¡m thá»i bong bÃ³ng chat toÃ¡n há»c trong khi MathJax Ä‘ang render */
.ai-bubble-mathjax-pending {
Â  visibility: hidden;
}

mark.highlight {background-color:#fde047;color:black;font-weight:bold;padding:0 3px;border-radius:3px;}
textarea,input{width:100%;padding:0.75rem;border-radius:0.75rem;background:#1e1e2a;border:1px solid #333;color:white;resize:none;outline:none;}
button{padding:0.75rem 1rem;border-radius:0.75rem;font-weight:bold;cursor:pointer;transition:all 0.2s; border: none;}
#btnCreateImage{background:#10b981;color:#111827;}#btnCreateImage:hover{background:#059669;}
.send-btn{background:#6366f1;color:white;} .send-btn:hover{background:#4f46e5;} /* Gá»™p chung cho cÃ¡c nÃºt gá»­i */
img.generated-image, .generated-video {border-radius:12px;max-width:100%;margin-top:1rem; display: block; max-height: 400px; margin-left: auto; margin-right: auto;}
#settings-btn{position:absolute;top:1rem;right:1rem;font-size:1.5rem;cursor:pointer;color:#facc15;}
#settings-modal{position:absolute;top:3rem;right:1rem;width:200px;background:#1a1c29;border:1px solid #facc15;border-radius:0.75rem;padding:1rem;display:none; z-index: 100;}
.pending-preview{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px;}
.pending-preview img{width:60px;height:60px;object-fit:cover;border-radius:8px;border:2px solid #475569;}
.input-row{display:flex;align-items:center;gap:6px;margin-top:8px;}
.icon-btn{background:#27293a;padding:8px;border-radius:8px;cursor:pointer;transition:0.2s;}
.icon-btn:hover{background:#3f4259;}
.icon-btn svg{width:22px;height:22px;color:#facc15;}
.send-btn{background:#6366f1;padding:10px;border-radius:50%;display:flex;align-items:center;justify-content:center;}
.send-btn:hover{background:#4f46e5;}
.send-btn svg{width:22px;height:22px;transform:rotate(0deg);}
</style>
<script src="https://unpkg.com/gif.js@0.2.0/dist/gif.js"></script>
<script src="https://unpkg.com/gif.js@0.2.0/dist/gif.worker.js"></script>
</head>

<body>
<div id="intro-screen">
Â  <div id="intro-bg"></div>
Â  <div id="intro-text">ğŸŒŒ Welcome to <mark class="highlight">AI Assistant Pro</mark> ğŸŒŒ</div>
Â  <div id="intro-subtext">Unleash the magic of creativity and intelligence.</div>
</div>

<div class="container relative" id="mainApp">
Â  <div id="settings-btn">âš™ï¸</div>
Â  <div id="settings-modal">
Â  Â  <label class="block mb-2">NgÃ´n ngá»¯ chat:</label>
Â  Â  <select id="language-select" class="w-full p-2 rounded bg-gray-800 text-white">
Â  Â  Â  <option value="vi">Tiáº¿ng Viá»‡t</option>
Â  Â  Â  <option value="en">English</option>
Â  Â  Â  <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
Â  Â  </select>
Â  </div>

Â  <div class="tabs">
Â  Â  <div class="tab-btn active" data-tab="image">ğŸ–¼ï¸ Táº¡o áº¢nh</div>
Â  Â  <div class="tab-btn" data-tab="chat">ğŸ’¬ Chat</div>
Â  Â  <div class="tab-btn" data-tab="math">ğŸ§® Giáº£i ToÃ¡n</div>
Â  Â  <div class="tab-btn" data-tab="video">ğŸï¸ Táº¡o Video</div>
Â  </div>

Â  <div class="tab-content active" id="image">
Â  Â  <div class="chat-box" id="imageBox"></div>
Â  Â  <textarea id="imagePrompt" rows="2" placeholder="Nháº­p mÃ´ táº£ áº£nh..."></textarea>
Â  Â  <button id="btnCreateImage" class="mt-2 w-full">Táº¡o áº¢nh</button>
Â  </div>

Â  <div class="tab-content" id="chat">
Â  Â  <div class="chat-box" id="chatBox"></div>
Â  Â  <div class="pending-preview" id="chatPreview"></div>
Â  Â  <div class="input-row">
Â  Â  Â  <label class="icon-btn" for="chatFileInput" title="Táº£i áº£nh hoáº·c file">ğŸ“</label>
Â  Â  Â  <input type="file" id="chatFileInput" accept="image/*" hidden />
Â  Â  Â  <textarea id="chatInput" rows="1" placeholder="Nháº­p tin nháº¯n..."></textarea>
Â  Â  Â  <button id="btnChat" class="send-btn" title="Gá»­i">
Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="white" viewBox="0 0 24 24">
Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12l14 7-7-7 7-7-14 7z"/>
Â  Â  Â  Â  </svg>
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>

Â  <div class="tab-content" id="math">
Â  Â  <div class="chat-box" id="mathBox"></div>
Â  Â  <div class="pending-preview" id="mathPreview"></div>
Â  Â  <div class="input-row">
Â  Â  Â  <label class="icon-btn" for="mathFileInput" title="Táº£i áº£nh hoáº·c file">ğŸ“</label>
Â  Â  Â  <input type="file" id="mathFileInput" accept="image/*" hidden />
Â  Â  Â  <textarea id="mathPrompt" rows="1" placeholder="Nháº­p bÃ i toÃ¡n..."></textarea>
Â  Â  Â  <button id="btnMath" class="send-btn" title="Giáº£i">
Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="white" viewBox="0 0 24 24">
Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12l14 7-7-7 7-7-14 7z"/>
Â  Â  Â  Â  </svg>
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>

Â  <div class="tab-content" id="video">
Â  Â  <div class="chat-box" id="videoBox"></div>
Â  Â  <div class="pending-preview" id="videoPreview"></div>
Â  Â  <div class="input-row">
Â  Â  Â  Â <textarea id="videoPrompt" rows="1" placeholder="Nháº­p mÃ´ táº£ video..."></textarea>
Â  Â  Â  <button id="btnVideo" class="send-btn" title="Táº¡o Video">
Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="white" viewBox="0 0 24 24">
Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12l14 7-7-7 7-7-14 7z"/>
Â  Â  Â  Â  </svg>
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>
</div>

<script>
// =======================================================
// === MÃƒ Gá»C Cá»¦A Báº N (GIá»® NGUYÃŠN) ===
// =======================================================
// Hiá»‡u á»©ng má»Ÿ Ä‘áº§u
function playIntro() {
Â  const intro = document.getElementById("intro-screen");
Â  const mainApp = document.getElementById("mainApp");

Â  // Sau 6s áº©n intro vÃ  hiá»‡n app
Â  setTimeout(() => {
Â  Â  intro.style.opacity = "0";
Â  Â  setTimeout(() => {
Â  Â  Â  intro.style.display = "none";
Â  Â  Â  mainApp.style.display = "block";
Â  Â  Â  document.body.style.overflow = "auto";
Â  Â  }, 1800);
Â  }, 6000);
}
playIntro();

/* Tabs */
const tabs=document.querySelectorAll(".tab-btn");
const contents=document.querySelectorAll(".tab-content");
tabs.forEach(tab=>tab.addEventListener("click",()=>{tabs.forEach(t=>t.classList.remove("active"));contents.forEach(c=>c.classList.remove("active"));tab.classList.add("active");document.getElementById(tab.dataset.tab).classList.add("active");}));


// =======================================================
// === START: MÃƒ Bá»” SUNG Äá»‚ FIX Lá»–I VÃ€ THÃŠM CHá»¨C NÄ‚NG ===
// =======================================================
document.addEventListener('DOMContentLoaded', () => {

Â  Â  // === Láº¥y cÃ¡c pháº§n tá»­ DOM ===
Â  Â  const imageBox = document.getElementById('imageBox');
Â  Â  const imagePrompt = document.getElementById('imagePrompt');
Â  Â  const btnCreateImage = document.getElementById('btnCreateImage');

Â  Â  const chatBox = document.getElementById('chatBox');
Â  Â  const chatInput = document.getElementById('chatInput');
Â  Â  const btnChat = document.getElementById('btnChat');
Â  Â  const chatFileInput = document.getElementById('chatFileInput');
Â  Â  const chatPreview = document.getElementById('chatPreview');

Â  Â  const mathBox = document.getElementById('mathBox');
Â  Â  const mathPrompt = document.getElementById('mathPrompt');
Â  Â  const btnMath = document.getElementById('btnMath');
Â  Â  const mathFileInput = document.getElementById('mathFileInput');
Â  Â  const mathPreview = document.getElementById('mathPreview');
Â  Â Â 
Â  Â  const videoBox = document.getElementById('videoBox');
Â  Â  const videoPrompt = document.getElementById('videoPrompt');
Â  Â  const btnVideo = document.getElementById('btnVideo');

Â  Â  const languageSelect = document.getElementById('language-select');
Â  Â  const settingsBtn = document.getElementById('settings-btn');
Â  Â  const settingsModal = document.getElementById('settings-modal');
Â  Â Â 
Â  Â  // LÆ°u trá»¯ áº£nh Ä‘Ã£ upload (dÆ°á»›i dáº¡ng base64)
Â  Â  let uploadedFiles = { chat: null, math: null };

Â  Â  // === HÃ m trá»£ giÃºp ===

Â  Â  // ThÃªm tin nháº¯n vÃ o há»™p chat
Â  Â  function appendMessage(box, content, type) {
Â  Â  Â  Â  const bubble = document.createElement('div');
Â  Â  Â  Â  // THAY Äá»”I: KhÃ´ng thÃªm class áº©n á»Ÿ Ä‘Ã¢y, chá»‰ thÃªm khi nháº­n káº¿t quáº£ toÃ¡n há»c
Â  Â  Â  Â  bubble.classList.add('bubble', type === 'user' ? 'user-bubble' : 'ai-bubble');
Â  Â  Â  Â  bubble.innerHTML = content; // DÃ¹ng innerHTML Ä‘á»ƒ render tháº» <mark> vÃ  <img>
Â  Â  Â  Â  box.appendChild(bubble);
Â  Â  Â  Â  box.scrollTop = box.scrollHeight; // Tá»± Ä‘á»™ng cuá»™n xuá»‘ng
Â  Â  Â  Â  return bubble;
Â  Â  }

Â  Â  // Hiá»ƒn thá»‹ loading...
Â  Â  function showLoading(box) {
Â  Â  Â  Â  return appendMessage(box, 'Äang xá»­ lÃ½...', 'ai');
Â  Â  }

Â  Â  // Xá»­ lÃ½ file upload
Â  Â  function handleFileUpload(event, type) {
Â  Â  Â  Â  const file = event.target.files[0];
Â  Â  Â  Â  if (!file) return;

Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  reader.onloadend = () => {
Â  Â  Â  Â  Â  Â  uploadedFiles[type] = reader.result;
Â  Â  Â  Â  Â  Â  const previewContainer = type === 'chat' ? chatPreview : mathPreview;
Â  Â  Â  Â  Â  Â  previewContainer.innerHTML = `<img src="${reader.result}" alt="preview">`;
Â  Â  Â  Â  };
Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  }

Â  Â  // === GÃ¡n sá»± kiá»‡n cho cÃ¡c nÃºt ===

Â  Â  // 1. Táº¡o áº£nh
Â  Â  btnCreateImage.addEventListener('click', async () => {
Â  Â  Â  Â  const prompt = imagePrompt.value.trim();
Â  Â  Â  Â  if (!prompt) return;

Â  Â  Â  Â  appendMessage(imageBox, prompt, 'user');
Â  Â  Â  Â  const loadingBubble = showLoading(imageBox);
Â  Â  Â  Â  imagePrompt.value = '';

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const response = await fetch('/api/pollinations-image', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ prompt }),
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error('Lá»—i tá»« server: ' + response.statusText);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  loadingBubble.innerHTML = `<img src="${data.imageUrl}" class="generated-image" alt="Generated Image">`;
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  loadingBubble.textContent = `âŒ Lá»—i: ${error.message}`;
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // 2. Chat
Â  Â  async function handleChat() {
Â  Â  Â  Â  const message = chatInput.value.trim();
Â  Â  Â  Â  const image = uploadedFiles.chat;
Â  Â  Â  Â  if (!message && !image) return;

Â  Â  Â  Â  appendMessage(chatBox, message, 'user');
Â  Â  Â  Â  const loadingBubble = showLoading(chatBox);
Â  Â  Â  Â  chatInput.value = '';
Â  Â  Â  Â  chatPreview.innerHTML = ''; // XÃ³a preview
Â  Â  Â  Â  uploadedFiles.chat = null;

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const response = await fetch('/api/chat', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  image, // gá»­i áº£nh base64 náº¿u cÃ³
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  language: languageSelect.value,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  history: [] // CÃ³ thá»ƒ thÃªm lá»‹ch sá»­ chat sau
Â  Â  Â  Â  Â  Â  Â  Â  }),
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error('Lá»—i tá»« server: ' + response.statusText);
Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  loadingBubble.innerHTML = data.response;
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  loadingBubble.textContent = `âŒ Lá»—i: ${error.message}`;
Â  Â  Â  Â  }
Â  Â  }
Â  Â  btnChat.addEventListener('click', handleChat);
Â  Â  chatInput.addEventListener('keydown', (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleChat(); } });


Â  Â  // 3. Giáº£i toÃ¡n
Â  Â  async function handleMath() {
Â  Â  Â  Â  const question = mathPrompt.value.trim();
Â  Â  Â  Â  const image = uploadedFiles.math;
Â  Â  Â  Â  if (!question && !image) return;

Â  Â  Â  Â  appendMessage(mathBox, question, 'user');
Â  Â  Â  Â  const loadingBubble = showLoading(mathBox);
Â  Â  Â  Â  mathPrompt.value = '';
Â  Â  Â  Â  mathPreview.innerHTML = '';
Â  Â  Â  Â  uploadedFiles.math = null;

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const response = await fetch('/api/math', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ question, image }),
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error('Lá»—i tá»« server: ' + response.statusText);
Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // THAY Äá»”I: ThÃªm logic áº©n/hiá»‡n Ä‘á»ƒ trÃ¡nh tháº¥y kÃ½ hiá»‡u LaTeX $...$ vÃ  tháº» <mark> trÆ°á»›c khi render
Â  Â  Â  Â  Â  Â  loadingBubble.innerHTML = data.response;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // 1. ThÃªm class áº©n
Â  Â  Â  Â  Â  Â  loadingBubble.classList.add('ai-bubble-mathjax-pending');

Â  Â  Â  Â  Â  Â  // 2. YÃªu cáº§u MathJax render láº¡i cÃ´ng thá»©c LaTeX (sá»­ dá»¥ng await Ä‘á»ƒ Ä‘áº£m báº£o nÃ³ render xong)
Â  Â  Â  Â  Â  Â  await MathJax.typesetPromise([loadingBubble]);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 3. Sau khi render xong, loáº¡i bá» class áº©n Ä‘á»ƒ hiá»ƒn thá»‹ ná»™i dung mÆ°á»£t mÃ 
Â  Â  Â  Â  Â  Â  loadingBubble.classList.remove('ai-bubble-mathjax-pending');


Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  loadingBubble.textContent = `âŒ Lá»—i: ${error.message}`;
Â  Â  Â  Â  Â  Â  loadingBubble.classList.remove('ai-bubble-mathjax-pending'); // Äáº£m báº£o lá»—i Ä‘Æ°á»£c hiá»ƒn thá»‹
Â  Â  Â  Â  }
Â  Â  }
Â  Â  btnMath.addEventListener('click', handleMath);
Â  Â  mathPrompt.addEventListener('keydown', (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleMath(); } });

Â  Â  // 4. Táº¡o Video (GIF)
Â  Â  btnVideo.addEventListener('click', async () => {
Â  Â  Â  Â  const prompt = videoPrompt.value.trim();
Â  Â  Â  Â  if (!prompt) return;

Â  Â  Â  Â  appendMessage(videoBox, prompt, 'user');
Â  Â  Â  Â  const loadingBubble = showLoading(videoBox);
Â  Â  Â  Â  videoPrompt.value = '';
Â  Â  Â  Â Â 
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // BÆ°á»›c 1: Gá»i API Ä‘á»ƒ láº¥y cÃ¡c khung hÃ¬nh
Â  Â  Â  Â  Â  Â  loadingBubble.textContent = 'Äang táº£i cÃ¡c khung hÃ¬nh (bÆ°á»›c 1/2)...';
Â  Â  Â  Â  Â  Â  const frameResponse = await fetch('/api/pollinations-frames', {
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ prompt }),
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (!frameResponse.ok) throw new Error(`Lá»—i táº£i khung hÃ¬nh: ${frameResponse.statusText}`);
Â  Â  Â  Â  Â  Â  const { frames } = await frameResponse.json();

Â  Â  Â  Â  Â  Â  if (!frames || frames.length === 0) throw new Error('KhÃ´ng nháº­n Ä‘Æ°á»£c khung hÃ¬nh nÃ o.');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // BÆ°á»›c 2: DÃ¹ng gif.js Ä‘á»ƒ táº¡o GIF tá»« cÃ¡c khung hÃ¬nh
Â  Â  Â  Â  Â  Â  loadingBubble.textContent = `Äang render video tá»« ${frames.length} khung hÃ¬nh (bÆ°á»›c 2/2)...`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const gif = new GIF({
Â  Â  Â  Â  Â  Â  Â  Â  workers: 2,
Â  Â  Â  Â  Â  Â  Â  Â  quality: 10,
Â  Â  Â  Â  Â  Â  Â  Â  width: 512,
Â  Â  Â  Â  Â  Â  Â  Â  height: 512
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const imagePromises = frames.map(frameData => {
Â  Â  Â  Â  Â  Â  Â  Â  return new Promise(resolve => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  img.src = frameData;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  img.onload = () => resolve(img);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const imageElements = await Promise.all(imagePromises);

Â  Â  Â  Â  Â  Â  imageElements.forEach(img => {
Â  Â  Â  Â  Â  Â  Â  Â  gif.addFrame(img, { delay: 100 }); // 100ms per frame
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  gif.on('finished', function(blob) {
Â  Â  Â  Â  Â  Â  Â  Â  const videoUrl = URL.createObjectURL(blob);
Â  Â  Â  Â  Â  Â  Â  Â  loadingBubble.innerHTML = `<img src="${videoUrl}" class="generated-video" alt="Generated Video">`;
Â  Â  Â  Â  Â  Â  Â  Â  videoBox.scrollTop = videoBox.scrollHeight;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  gif.render();

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  loadingBubble.textContent = `âŒ Lá»—i: ${error.message}`;
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // === Sá»± kiá»‡n khÃ¡c ===
Â  Â  chatFileInput.addEventListener('change', (e) => handleFileUpload(e, 'chat'));
Â  Â  mathFileInput.addEventListener('change', (e) => handleFileUpload(e, 'math'));

Â  Â  // Má»Ÿ/Ä‘Ã³ng settings
Â  Â  settingsBtn.addEventListener('click', () => {
Â  Â  Â  Â  settingsModal.style.display = settingsModal.style.display === 'block' ? 'none' : 'block';
Â  Â  });
Â  Â  // ÄÃ³ng settings khi click ra ngoÃ i
Â  Â  document.addEventListener('click', (e) => {
Â  Â  Â  Â  if (!settingsModal.contains(e.target) && !settingsBtn.contains(e.target)) {
Â  Â  Â  Â  Â  Â  settingsModal.style.display = 'none';
Â  Â  Â  Â  }
Â  Â  });
});
// === END: MÃƒ Bá»” SUNG ===
</script>
</body>
</html>